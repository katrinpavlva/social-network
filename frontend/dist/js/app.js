(function(){"use strict";var e={7571:function(e,s,o){o(560);var t=o(9242),i=o(3396);const n={id:"app"};function r(e,s,o,t,r,a){const l=(0,i.up)("router-view");return(0,i.wg)(),(0,i.iD)("div",n,[(0,i.Wm)(l)])}var a={name:"App",created(){this.checkCookie()},methods:{checkCookie(){const e=document.cookie.split(";").find((e=>e.trim().startsWith("session_id=")));e||(localStorage.clear(),this.$store.dispatch("logOut"),this.$router.push("/welcome"))}}},l=o(89);const c=(0,l.Z)(a,[["render",r]]);var u=c,d=o(2483),p=o(65);const g=localStorage.getItem("isLoggedIn");var h=(0,p.MT)({state:{isLoggedIn:!!g&&JSON.parse(g)},mutations:{setLoggedIn(e,s){e.isLoggedIn=s,localStorage.setItem("isLoggedIn",JSON.stringify(s))}},actions:{logIn({commit:e}){e("setLoggedIn",!0),ya.push("/")},logOut({commit:e}){e("setLoggedIn",!1),ya.push("/welcome")}}}),m=o(7139);const f=e=>((0,i.dD)("data-v-af0baf24"),e=e(),(0,i.Cn)(),e),w={key:0,class:"modal"},I={class:"form-container"},v={class:"tabs"},y=f((()=>(0,i._)("h2",null,"Sign In",-1))),U=f((()=>(0,i._)("button",{type:"submit"},"Sign In",-1))),k=f((()=>(0,i._)("br",null,null,-1))),C={key:0,class:"error-message"},_=f((()=>(0,i._)("h2",null,"Register",-1))),b={key:0},R=f((()=>(0,i._)("option",{value:"Public"},"Account Privacy - Public",-1))),D=f((()=>(0,i._)("option",{value:"Private"},"Account Privacy - Private",-1))),N=[R,D],S=f((()=>(0,i._)("br",null,null,-1))),q={key:0,class:"error-message"},M={key:1},P=f((()=>(0,i._)("h4",null,"Optional",-1))),O=f((()=>(0,i._)("option",{value:"",disabled:"",selected:"",hidden:""},"Gender",-1))),E=f((()=>(0,i._)("option",{value:""},"Prefer not to say",-1))),J=f((()=>(0,i._)("option",{value:"Male"},"Male",-1))),G=f((()=>(0,i._)("option",{value:"Female"},"Female",-1))),z=[O,E,J,G],F=f((()=>(0,i._)("button",{type:"submit"},"Sign Up",-1))),L=f((()=>(0,i._)("br",null,null,-1))),A={key:0,class:"error-message"};function W(e,s,o,n,r,a){return r.showModal?((0,i.wg)(),(0,i.iD)("div",w,[(0,i._)("div",I,[(0,i._)("div",v,[(0,i._)("div",{class:(0,m.C_)(["tab",{active:"signup"===r.showForm}]),onClick:s[0]||(s[0]=e=>r.showForm="signup")},"Register",2),(0,i._)("div",{class:(0,m.C_)(["tab",{active:"signin"===r.showForm}]),onClick:s[1]||(s[1]=e=>r.showForm="signin")},"Login",2)]),"signin"===r.showForm?((0,i.wg)(),(0,i.iD)("form",{key:0,onSubmit:s[4]||(s[4]=(0,t.iM)(((...e)=>a.handleSignIn&&a.handleSignIn(...e)),["prevent"])),class:"form-content"},[y,(0,i.wy)((0,i._)("input",{type:"text",placeholder:"Email or Nickname","onUpdate:modelValue":s[2]||(s[2]=e=>r.signInUser.credential=e),name:"credential",required:""},null,512),[[t.nr,r.signInUser.credential]]),(0,i.wy)((0,i._)("input",{type:"password",placeholder:"Password","onUpdate:modelValue":s[3]||(s[3]=e=>r.signInUser.password=e),name:"password",required:""},null,512),[[t.nr,r.signInUser.password]]),U,k,r.signInError?((0,i.wg)(),(0,i.iD)("div",C,(0,m.zw)(r.signInError),1)):(0,i.kq)("",!0)],32)):(0,i.kq)("",!0),"signup"===r.showForm?((0,i.wg)(),(0,i.iD)("form",{key:1,onSubmit:s[17]||(s[17]=(0,t.iM)(((...e)=>a.handleSignUp&&a.handleSignUp(...e)),["prevent"])),class:"form-content"},[_,1===r.signUpStep?((0,i.wg)(),(0,i.iD)("div",b,[(0,i.wy)((0,i._)("input",{type:"email",placeholder:"Email","onUpdate:modelValue":s[5]||(s[5]=e=>r.signUpUser.email=e),required:""},null,512),[[t.nr,r.signUpUser.email]]),(0,i.wy)((0,i._)("input",{type:"password",placeholder:"Password","onUpdate:modelValue":s[6]||(s[6]=e=>r.signUpUser.password=e),required:""},null,512),[[t.nr,r.signUpUser.password]]),(0,i.wy)((0,i._)("input",{type:"text",placeholder:"First Name","onUpdate:modelValue":s[7]||(s[7]=e=>r.signUpUser.firstName=e),required:""},null,512),[[t.nr,r.signUpUser.firstName]]),(0,i.wy)((0,i._)("input",{type:"text",placeholder:"Last Name","onUpdate:modelValue":s[8]||(s[8]=e=>r.signUpUser.lastName=e),required:""},null,512),[[t.nr,r.signUpUser.lastName]]),(0,i.wy)((0,i._)("input",{type:"date",placeholder:"Date of Birth","onUpdate:modelValue":s[9]||(s[9]=e=>r.signUpUser.dateOfBirth=e),required:""},null,512),[[t.nr,r.signUpUser.dateOfBirth]]),(0,i.wy)((0,i._)("select",{"onUpdate:modelValue":s[10]||(s[10]=e=>r.signUpUser.profilePrivacy=e)},N,512),[[t.bM,r.signUpUser.profilePrivacy]]),(0,i._)("button",{type:"button",onClick:s[11]||(s[11]=(...e)=>a.nextStep&&a.nextStep(...e))},"Next"),S,r.signUpError?((0,i.wg)(),(0,i.iD)("div",q,(0,m.zw)(r.signUpError),1)):(0,i.kq)("",!0)])):(0,i.kq)("",!0),2===r.signUpStep?((0,i.wg)(),(0,i.iD)("div",M,[P,(0,i._)("input",{type:"file",onChange:s[12]||(s[12]=(...e)=>a.handleFileUpload&&a.handleFileUpload(...e))},null,32),(0,i.wy)((0,i._)("input",{type:"text",placeholder:"Nickname","onUpdate:modelValue":s[13]||(s[13]=e=>r.signUpUser.nickname=e)},null,512),[[t.nr,r.signUpUser.nickname]]),(0,i.wy)((0,i._)("select",{"onUpdate:modelValue":s[14]||(s[14]=e=>r.signUpUser.gender=e)},z,512),[[t.bM,r.signUpUser.gender]]),(0,i.wy)((0,i._)("textarea",{placeholder:"About Me","onUpdate:modelValue":s[15]||(s[15]=e=>r.signUpUser.aboutMe=e)},null,512),[[t.nr,r.signUpUser.aboutMe]]),(0,i._)("button",{type:"button",onClick:s[16]||(s[16]=(...e)=>a.previousStep&&a.previousStep(...e))},"Previous"),F,L,r.signUpError?((0,i.wg)(),(0,i.iD)("div",A,(0,m.zw)(r.signUpError),1)):(0,i.kq)("",!0)])):(0,i.kq)("",!0)],32)):(0,i.kq)("",!0)])])):(0,i.kq)("",!0)}var x={data(){return{showModal:!0,showForm:"signin",signInUser:{credential:"",password:""},signUpStep:1,signUpUser:{email:"",password:"",firstName:"",lastName:"",dateOfBirth:null,avatar:null,nickname:"",aboutMe:"",profilePrivacy:"Public",gender:""},signInError:"",signUpError:""}},computed:{...(0,p.rn)(["isLoggedIn"])},methods:{...(0,p.nv)(["logIn","logOut"]),nextStep(){this.signUpStep++},previousStep(){this.signUpStep--},handleFileUpload(e){const s=e.target.files[0];this.signUpUser.avatar=s},handleSignIn(){this.$axios.post("/api/login",{credential:this.signInUser.credential,password:this.signInUser.password}).then((e=>{this.logIn(),this.showModal=!1;const{user:s}=e.data;localStorage.setItem("user",JSON.stringify(s)),this.signInError="",console.log("Sign In Success:",e)})).catch((e=>{console.error("Sign In Error:",e),this.signInError=e.response.data.error||"Sign In failed. Please try again."}))},handleSignUp(){const e=new FormData;e.append("Email",this.signUpUser.email),e.append("Password",this.signUpUser.password),e.append("FirstName",this.signUpUser.firstName),e.append("LastName",this.signUpUser.lastName),e.append("DateOfBirth",this.signUpUser.dateOfBirth),e.append("ProfilePrivacy",this.signUpUser.profilePrivacy),e.append("Gender",this.signUpUser.gender),this.signUpUser.avatar&&e.append("profilePicture",this.signUpUser.avatar),e.append("Nickname",this.signUpUser.nickname),e.append("AboutMe",this.signUpUser.aboutMe),this.$axios.post("/api/register",e).then((e=>{console.log(e),this.showForm="signin",this.signUpError="",this.signInUser.credential=this.signUpUser.email,this.signInUser.password=this.signUpUser.password})).catch((e=>{console.error(e),this.signUpError=e.response.data.error||"Registration failed. Please try again."}))}}};const $=(0,l.Z)(x,[["render",W],["__scopeId","data-v-af0baf24"]]);var j=$;const V=(0,i._)("div",{class:"header-element-wrapper"},[(0,i._)("h1",null,"Welcome to the Home Page")],-1),T={class:"header-element-wrapper"},Y={class:"navbar"},H={class:"header-element-wrapper"},K={class:"main-container"},B={class:"content-wrapper"},Z={class:"content-body"},Q={class:"chat-windows-container"},X={class:"user-list"},ee=(0,i._)("h2",null,"Contacts",-1),se=["onClick"],oe=["src"],te={key:0,class:"unread-indicator"},ie={class:"left-sidebar"},ne={class:"action-buttons-left-sidebar"},re={class:"notification-center-header"},ae=(0,i._)("span",{class:"sidebar-back"},[(0,i._)("svg",{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:"512.000000pt",height:"512.000000pt",viewBox:"0 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet"},[(0,i._)("g",{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",fill:"#000000",stroke:"none"},[(0,i._)("path",{d:"M2058 4727 c-31 -13 -74 -38 -95 -55 -77 -62 -1882 -1878 -1907\n                -1920 -38 -61 -60 -154 -52 -225 14 -132 -40 -73 1014 -1129 795 -796 975\n                -971 1020 -994 78 -39 202 -46 285 -14 89 34 153 90 191 169 28 60 31 75 31\n                161 0 165 16 144 -562 729 -274 278 -534 536 -579 575 -45 40 -118 91 -167\n                116 l-86 45 1837 5 1837 5 57 23 c81 33 160 108 200 190 30 60 33 75 33 152\n                -1 70 -5 95 -27 142 -35 76 -99 143 -173 181 l-60 32 -1855 5 -1855 5 95 50\n                95 49 576 576 c665 664 634 624 634 795 0 89 -3 106 -28 156 -15 31 -50 78\n                -77 103 -72 68 -126 89 -235 93 -77 3 -98 0 -147 -20z"})])])],-1),le=[ae],ce=(0,i._)("h2",null,"Notifications",-1),ue={class:"notification-list"},de={key:0},pe={key:0,class:"notification-message"},ge={class:"event-invite-message"},he={class:"response-buttons"},me=["onClick"],fe=["onClick"],we={key:1},Ie={class:"group-invite-message"},ve={class:"response-buttons"},ye=["onClick"],Ue=["onClick"],ke={key:2},Ce={class:"follow-request-message"},_e={class:"response-buttons"},be=["onClick"],Re=["onClick"],De={key:3},Ne={class:"group-join-request-message"},Se={class:"response-buttons"},qe=["onClick"],Me=["onClick"];function Pe(e,s,o,t,n,r){const a=(0,i.up)("router-link"),l=(0,i.up)("ContentContainer"),c=(0,i.up)("ChatWindow");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("header",null,[V,(0,i._)("div",T,[(0,i._)("nav",Y,[(0,i.Wm)(a,{to:"/",class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("HOME")])),_:1}),(0,i.Wm)(a,{to:"/groups",class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("GROUPS")])),_:1}),(0,i.Wm)(a,{to:"/users",class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("USERS")])),_:1}),(0,i.Wm)(a,{to:`/profile/${r.currentUserId}`,class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("PROFILE")])),_:1},8,["to"])])]),(0,i._)("div",H,[(0,i._)("button",{onClick:s[0]||(s[0]=(...e)=>r.handleLogout&&r.handleLogout(...e))},"Log Out")])]),(0,i._)("div",K,[(0,i._)("div",B,[(0,i._)("section",Z,[(0,i.Wm)(l,{currentUserId:r.currentUserId},null,8,["currentUserId"]),(0,i._)("div",Q,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.filteredOpenChats,(e=>((0,i.wg)(),(0,i.j4)(c,{key:e.RoomID,currentRoomId:e.RoomID,messages:n.messages.filter((s=>s.roomId===e.RoomID)),currentUserId:r.currentUserId,sendMessageFunction:r.sendChatMessage,onCloseChat:r.handleCloseChat,class:"chat-window"},null,8,["currentRoomId","messages","currentUserId","sendMessageFunction","onCloseChat"])))),128))])]),(0,i._)("aside",X,[ee,(0,i._)("ul",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.followRelations,(e=>((0,i.wg)(),(0,i.iD)("li",{key:e.UserID,onClick:s=>r.handleUserClick(e)},[(0,i._)("img",{src:e.profilePicture||n.defaultProfilePic,alt:"Profile Image",class:"profile-image"},null,8,oe),(0,i.Uk)(" "+(0,m.zw)(e.FirstName+" "+e.LastName)+" ",1),e.UnreadCount?((0,i.wg)(),(0,i.iD)("span",te,(0,m.zw)(e.UnreadCount),1)):(0,i.kq)("",!0)],8,se)))),128))])]),(0,i._)("aside",ie,[(0,i._)("div",ne,[(0,i._)("button",{onClick:s[1]||(s[1]=e=>r.toggleNotificationCenter())},"Notification Center")])]),(0,i._)("aside",{class:(0,m.C_)(["notification-center",{"is-visible":n.isNotificationCenterVisible}])},[(0,i._)("div",re,[(0,i._)("button",{onClick:s[2]||(s[2]=e=>{n.isNotificationCenterVisible=!1,n.notifications=[]})},le),ce]),(0,i._)("div",ue,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.notifications,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.id,class:"notification"},["eventInvite"===e.type?((0,i.wg)(),(0,i.iD)("div",de,[n.notificationMessage?((0,i.wg)(),(0,i.iD)("div",pe,(0,m.zw)(n.notificationMessage),1)):(0,i.kq)("",!0),(0,i._)("p",ge,[(0,i.Uk)(" You have been invited to "),(0,i._)("strong",null,(0,m.zw)(e.groupName),1),(0,i.Uk)(" event "),(0,i._)("strong",null,'"'+(0,m.zw)(e.title)+'"',1),(0,i.Uk)(" by "),(0,i._)("strong",null,(0,m.zw)(e.creatorFirstName)+" "+(0,m.zw)(e.creatorLastName),1)]),(0,i._)("div",he,[(0,i._)("button",{class:"going",onClick:s=>r.handleResponse(e,"Going","event")},"Going",8,me),(0,i._)("button",{class:"notGoing",onClick:s=>r.handleResponse(e,"Not Going","event")},"Not Going",8,fe)])])):"groupInvite"===e.type?((0,i.wg)(),(0,i.iD)("div",we,[(0,i._)("p",Ie,[(0,i.Uk)(" You have been invited to join the group "),(0,i._)("strong",null,'"'+(0,m.zw)(e.groupName)+'"',1),(0,i.Uk)(" by "),(0,i._)("strong",null,(0,m.zw)(e.creatorName),1),(0,i.Uk)(". ")]),(0,i._)("div",ve,[(0,i._)("button",{class:"accept",onClick:s=>r.handleResponse(e,!0,"group")},"Accept",8,ye),(0,i._)("button",{class:"decline",onClick:s=>r.handleResponse(e,!1,"group")},"Decline",8,Ue)])])):"followRequest"===e.type?((0,i.wg)(),(0,i.iD)("div",ke,[(0,i._)("p",Ce,[(0,i._)("strong",null,(0,m.zw)(e.firstName)+" "+(0,m.zw)(e.lastName),1),(0,i.Uk)(" wants to follow you. ")]),(0,i._)("div",_e,[(0,i._)("button",{class:"accept",onClick:s=>r.handleResponse(e,!0,"follow")},"Accept",8,be),(0,i._)("button",{class:"decline",onClick:s=>r.handleResponse(e,!1,"follow")},"Decline",8,Re)])])):(0,i.kq)("",!0),"groupJoinRequest"===e.type?((0,i.wg)(),(0,i.iD)("div",De,[(0,i._)("p",Ne,[(0,i._)("strong",null,(0,m.zw)(e.FirstName)+" "+(0,m.zw)(e.LastName),1),(0,i.Uk)(" wants to join your group "),(0,i._)("strong",null,'"'+(0,m.zw)(e.groupName)+'"',1),(0,i.Uk)(". ")]),(0,i._)("div",Se,[(0,i._)("button",{class:"accept",onClick:s=>r.handleResponse(e,!0,"groupJoinRequest")},"Accept",8,qe),(0,i._)("button",{class:"decline",onClick:s=>r.handleResponse(e,!1,"groupJoinRequest")},"Decline",8,Me)])])):(0,i.kq)("",!0)])))),128))])],2)])])],64)}const Oe=e=>((0,i.dD)("data-v-1978d54e"),e=e(),(0,i.Cn)(),e),Ee={key:0,class:"chat-window"},Je={class:"chat-header"},Ge={class:"chat-messages",ref:"messagesContainer"},ze={class:"message-content"},Fe={class:"message-timestamp"},Le={class:"chat-input"},Ae={key:0,class:"emoji-picker"},We=["onClick"],xe={class:"input-area-button-container"},$e=Oe((()=>(0,i._)("span",{class:"emoji"},"ðŸ˜Š",-1))),je=[$e];function Ve(e,s,o,n,r,a){return o.currentRoomId?((0,i.wg)(),(0,i.iD)("div",Ee,[(0,i._)("div",Je,[(0,i._)("span",null,(0,m.zw)(a.chatPartnerName),1),(0,i._)("span",{class:"close",onClick:s[0]||(s[0]=(...e)=>a.closeChat&&a.closeChat(...e))},"Ã—")]),(0,i._)("ul",Ge,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.messagesForCurrentRoom,(e=>((0,i.wg)(),(0,i.iD)("li",{key:e.messageId,class:(0,m.C_)({"message-sent":a.isCurrentUserSender(e),"message-received":!a.isCurrentUserSender(e)})},[(0,i._)("div",ze,(0,m.zw)(e.content),1),(0,i._)("div",Fe,(0,m.zw)(new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),1)],2)))),128))],512),(0,i._)("div",Le,[r.showEmojiPicker?((0,i.wg)(),(0,i.iD)("div",Ae,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.emojis,(e=>((0,i.wg)(),(0,i.iD)("button",{key:e,onClick:s=>a.addEmoji(e)},(0,m.zw)(e),9,We)))),128))])):(0,i.kq)("",!0),(0,i.wy)((0,i._)("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=e=>r.newMessage=e),onKeyup:s[2]||(s[2]=(0,t.D2)(((...e)=>a.sendMessage&&a.sendMessage(...e)),["enter"])),placeholder:"Type a message..."},null,544),[[t.nr,r.newMessage]]),(0,i._)("div",xe,[(0,i._)("button",{onClick:s[3]||(s[3]=(...e)=>a.toggleEmojiPicker&&a.toggleEmojiPicker(...e))},je),(0,i._)("button",{onClick:s[4]||(s[4]=(...e)=>a.sendMessage&&a.sendMessage(...e))},"Send")])])])):(0,i.kq)("",!0)}var Te={data(){return{newMessage:"",showEmojiPicker:!1,emojis:["ðŸ˜€","ðŸ˜","ðŸ˜‚","ðŸ¤£","ðŸ˜ƒ","ðŸ˜„","ðŸ˜…","ðŸ˜†","ðŸ˜‰","ðŸ˜Š","ðŸ˜‹","ðŸ˜Ž","ðŸ˜","ðŸ˜˜","ðŸ¥°","ðŸ˜—","ðŸ˜™","ðŸ˜š","ðŸ™‚","ðŸ¤—","ðŸ˜‡","ðŸ¤©","ðŸ¤”","ðŸ¤“","ðŸ˜","ðŸ˜Œ","ðŸ˜œ","ðŸ¤ª"]}},props:{currentRoomId:String,messages:Array,sendMessageFunction:Function,currentUserId:{type:[String,Number],required:!0}},computed:{messagesForCurrentRoom(){return this.messages.filter((e=>e.roomId===this.currentRoomId))},isCurrentUserSender(){return e=>e.senderUserId===this.currentUserId},chatPartnerName(){if(!this.messagesForCurrentRoom.length)return"User Name";const e=this.messagesForCurrentRoom[0];return e.senderUserId===this.currentUserId?`${e.receiverFirstName} ${e.receiverLastName}`:`${e.senderFirstName} ${e.senderLastName}`}},watch:{messages(){this.scrollToBottom()}},mounted(){this.scrollToBottom()},methods:{scrollToBottom(){this.$nextTick((()=>{const e=this.$refs.messagesContainer;e&&(e.scrollTop=e.scrollHeight)}))},sendMessage(){this.newMessage.trim()&&""!==this.newMessage&&(this.sendMessageFunction(this.newMessage,this.currentRoomId),this.newMessage="")},checkMessageSender(e){return console.log(`Message ID: ${e.messageId}, Sender ID: ${e.senderUserId}, Current User ID: ${this.currentUserId}`),e.senderUserID===this.currentUserId},closeChat(){this.$emit("closeChat",this.currentRoomId)},toggleEmojiPicker(){this.showEmojiPicker=!this.showEmojiPicker},addEmoji(e){this.newMessage+=e,this.toggleEmojiPicker()}}};const Ye=(0,l.Z)(Te,[["render",Ve],["__scopeId","data-v-1978d54e"]]);var He=Ye;const Ke=e=>((0,i.dD)("data-v-126a0267"),e=e(),(0,i.Cn)(),e),Be={class:"content-container"},Ze={class:"post-creation-area"},Qe={key:0},Xe={class:"selected-user-list"},es=["onClick"],ss=Ke((()=>(0,i._)("button",{type:"submit"},"Post",-1))),os={class:"posts-display-area"},ts={key:0},is={class:"post-header"},ns=["src"],rs={class:"user-info"},as={class:"user-name"},ls={class:"post-date"},cs={class:"post-body"},us={key:0,class:"post-content"},ds=["src"],ps={class:"post-actions"},gs=["onClick"],hs={key:1},ms=Ke((()=>(0,i._)("p",null,"No posts available.",-1))),fs=[ms],ws={key:0,class:"post-modal"},Is={class:"post-modal-content"},vs={class:"modal-header"},ys=["src"],Us={class:"user-info"},ks={class:"user-name"},Cs={class:"post-date"},_s={class:"modal-body"},bs=["src"],Rs={class:"modal-footer"},Ds={class:"comment-profile"},Ns=["src"],Ss=Ke((()=>(0,i._)("button",{type:"submit",class:"comment-submit"},"Comment",-1))),qs={class:"comment-profile"},Ms=["src"],Ps={class:"comment-body"},Os={class:"comment-header"},Es={class:"comment-author"},Js={class:"comment-timestamp"},Gs={class:"comment-content"},zs={key:0,class:"comment-media-container"},Fs=["src"],Ls=Ke((()=>(0,i._)("div",{class:"comment-actions"},null,-1)));function As(e,s,o,n,r,a){return(0,i.wg)(),(0,i.iD)("div",Be,[(0,i._)("div",Ze,[(0,i._)("form",{class:"post-form",onSubmit:s[5]||(s[5]=(0,t.iM)(((...e)=>a.submitPost&&a.submitPost(...e)),["prevent"]))},[(0,i.wy)((0,i._)("textarea",{"onUpdate:modelValue":s[0]||(s[0]=e=>r.newPost.content=e),placeholder:"What's happening?"},null,512),[[t.nr,r.newPost.content]]),(0,i._)("input",{type:"file",onChange:s[1]||(s[1]=(...e)=>a.handleImageUpload&&a.handleImageUpload(...e))},null,32),(0,i._)("div",null,[(0,i._)("label",null,[(0,i.wy)((0,i._)("input",{type:"radio","onUpdate:modelValue":s[2]||(s[2]=e=>r.newPost.privacy=e),value:"public"},null,512),[[t.G2,r.newPost.privacy]]),(0,i.Uk)(" Public")]),(0,i._)("label",null,[(0,i.wy)((0,i._)("input",{type:"radio","onUpdate:modelValue":s[3]||(s[3]=e=>r.newPost.privacy=e),value:"private"},null,512),[[t.G2,r.newPost.privacy]]),(0,i.Uk)(" Private")]),(0,i._)("label",null,[(0,i.wy)((0,i._)("input",{type:"radio","onUpdate:modelValue":s[4]||(s[4]=e=>r.newPost.privacy=e),value:"almost_private"},null,512),[[t.G2,r.newPost.privacy]]),(0,i.Uk)(" Almost Private")])]),"almost_private"===r.newPost.privacy?((0,i.wg)(),(0,i.iD)("div",Qe,[(0,i._)("ul",Xe,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.followRelations,(e=>((0,i.wg)(),(0,i.iD)("li",{key:e.UserID,class:(0,m.C_)({selected:a.isSelected(e.UserID)}),onClick:s=>a.toggleSelection(e.UserID)},(0,m.zw)(e.FirstName)+" "+(0,m.zw)(e.LastName),11,es)))),128))])])):(0,i.kq)("",!0),ss],32)]),(0,i._)("div",os,[a.filteredPosts.length>0?((0,i.wg)(),(0,i.iD)("div",ts,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.filteredPosts,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.postID,class:"post-card"},[(0,i._)("div",is,[(0,i._)("img",{src:e.profilePicture||r.defaultProfilePic,alt:"Profile Image",class:"profile-image"},null,8,ns),(0,i._)("div",rs,[(0,i._)("span",as,(0,m.zw)(e.firstName)+" "+(0,m.zw)(e.lastName),1),(0,i._)("span",ls,(0,m.zw)(a.formatTimestamp(e.timestamp)),1)])]),(0,i._)("div",cs,[e.content?((0,i.wg)(),(0,i.iD)("p",us,(0,m.zw)(e.content),1)):(0,i.kq)("",!0),e.imageURL?((0,i.wg)(),(0,i.iD)("img",{key:1,src:e.imageURL,alt:"Post image",class:"post-image"},null,8,ds)):(0,i.kq)("",!0)]),(0,i._)("div",ps,[(0,i._)("button",{class:"post-action-button",onClick:s=>a.openModal(e)},"Comment",8,gs)])])))),128))])):((0,i.wg)(),(0,i.iD)("div",hs,fs))]),r.activePost?((0,i.wg)(),(0,i.iD)("div",ws,[(0,i._)("div",Is,[(0,i._)("div",vs,[(0,i._)("img",{src:r.activePost.profilePicture||r.defaultProfilePic,alt:"Profile Image",class:"profile-image"},null,8,ys),(0,i._)("div",Us,[(0,i._)("span",ks,(0,m.zw)(r.activePost.firstName)+" "+(0,m.zw)(r.activePost.lastName),1),(0,i._)("span",Cs,(0,m.zw)(a.formatTimestamp(r.activePost.timestamp)),1)])]),(0,i._)("div",_s,[(0,i._)("p",null,(0,m.zw)(r.activePost.content),1),r.activePost.imageURL?((0,i.wg)(),(0,i.iD)("img",{key:0,src:r.activePost.imageURL,alt:"Post image",class:"post-image"},null,8,bs)):(0,i.kq)("",!0)]),(0,i._)("div",Rs,[(0,i._)("form",{onSubmit:s[8]||(s[8]=(0,t.iM)(((...e)=>a.submitComment&&a.submitComment(...e)),["prevent"])),enctype:"multipart/form-data",class:"comment-form"},[(0,i._)("div",Ds,[(0,i._)("img",{src:a.userImage||r.defaultProfilePic,alt:"Profile",class:"comment-profile-image"},null,8,Ns)]),(0,i.wy)((0,i._)("textarea",{"onUpdate:modelValue":s[6]||(s[6]=e=>r.newComment=e),placeholder:"Write a comment...",rows:"2",class:"comment-textarea"},"\n            ",512),[[t.nr,r.newComment]]),(0,i._)("input",{class:"comment-file-upload",type:"file",onChange:s[7]||(s[7]=(...e)=>a.handleCommentImageUpload&&a.handleCommentImageUpload(...e))},null,32),Ss],32),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.comments,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.commentID,class:"comment-container"},[(0,i._)("div",qs,[(0,i._)("img",{src:e.profilePicture||r.defaultProfilePic,alt:"Profile",class:"comment-profile-image"},null,8,Ms)]),(0,i._)("div",Ps,[(0,i._)("div",Os,[(0,i._)("span",Es,(0,m.zw)(e.firstName)+" "+(0,m.zw)(e.lastName),1),(0,i._)("span",Js,(0,m.zw)(a.formatTimestamp(e.timestamp)),1)]),(0,i._)("div",Gs,[(0,i.Uk)((0,m.zw)(e.content)+" ",1),e.commentMedia?((0,i.wg)(),(0,i.iD)("div",zs,[(0,i._)("img",{src:e.commentMedia,alt:"Comment media"},null,8,Fs)])):(0,i.kq)("",!0)]),Ls])])))),128))])]),(0,i._)("div",{class:"post-modal-backdrop",onClick:s[9]||(s[9]=(...e)=>a.closeModal&&a.closeModal(...e))})])):(0,i.kq)("",!0)])}var Ws=o(1076);const xs="https://storage.googleapis.com/social-network-bucket/profilepics/user_icon.png";var $s={data(){return{defaultProfilePic:xs,userProfile:JSON.parse(localStorage.getItem("user"))||{},newPost:{content:"",privacy:"public",image:null,selectedUserIds:[]},followRelations:JSON.parse(localStorage.getItem("followRelations"))||[],posts:[],activePost:null,newComment:"",comments:[]}},mounted(){this.fetchPosts(),this.userProfile=JSON.parse(localStorage.getItem("user"))||{}},computed:{filteredPosts(){return this.posts?this.posts.filter((e=>this.isAllowedToView(e))):[]},userImage(){return this.userProfile.profilePicture||xs}},props:{currentUserId:Number,groupID:{type:[Number,String,null],default:null}},methods:{formatTimestamp(e){const s=new Date(e);return s.toLocaleDateString("en-US")},handleImageUpload(e){this.newPost.image=e.target.files[0]},toggleSelection(e){const s=this.newPost.selectedUserIds.indexOf(e);s>-1?this.newPost.selectedUserIds.splice(s,1):this.newPost.selectedUserIds.push(e)},isSelected(e){return this.newPost.selectedUserIds.includes(e)},submitPost(){const e=new FormData;e.append("content",this.newPost.content),e.append("privacy",this.newPost.privacy),e.append("selectedUserIds",JSON.stringify(this.newPost.selectedUserIds)),this.newPost.image&&e.append("image",this.newPost.image),this.groupID&&e.append("groupID",this.groupID),this.$axios.post("/api/createPost",e).then((e=>{this.posts=[e.data,...this.posts],console.log("This is the created Post:",e),this.newPost={content:"",privacy:"public",image:null}})).catch((e=>{console.error("Error creating post:",e)}))},fetchPosts(){console.log("Fetching posts for group:",this.groupID);let e="/api/posts";this.groupID&&(e+=`?groupID=${this.groupID}`),this.$axios.get(e).then((e=>{console.log("These are the fetched posts:",e.data),this.posts=e.data})).catch((e=>{console.error("Error fetching posts:",e)}))},fetchComments(e){this.$axios.get("/api/getComments",{params:{postID:e}}).then((e=>{console.log("Comments fetched:",e.data),this.comments=e.data})).catch((e=>{console.error("Error fetching comments:",e)}))},isAllowedToView(e){const s=this.currentUserId;if("private"===e.privacySetting)return this.followRelations.some((s=>s.UserID===e.UserID));if("almost_private"===e.privacySetting){const o=JSON.parse(e.allowedViewers);return o.includes(s)}return!0},openModal(e){this.activePost=e,this.fetchComments(e.postID)},closeModal(){this.activePost=null,this.newComment=""},handleCommentImageUpload(e){this.commentImage=e.target.files[0]},submitComment(){const e=new FormData;e.append("postID",this.activePost.postID),e.append("userID",this.currentUserId),e.append("content",this.newComment),this.commentImage&&e.append("image",this.commentImage),Ws.Z.post("/api/createComment",e).then((e=>{console.log("Comment created:",e.data),this.comments=[e.data,...this.comments],this.newComment="",this.commentImage=null})).catch((e=>{console.error("Error creating comment:",e)}))}}};const js=(0,l.Z)($s,[["render",As],["__scopeId","data-v-126a0267"]]);var Vs=js,Ts={name:"MainContainer",components:{ChatWindow:He,ContentContainer:Vs},data(){return{defaultProfilePic:xs,ws:null,serverUrl:"ws://localhost:1/ws",messages:[],unreadMessagesCount:{},newMessage:"",currentRoomId:null,openChats:{},followRelations:[],loadingFollowRelations:!0,groupName:"",groupDescription:"",notifications:[],notificationMessage:"",isNotificationCenterVisible:!1,pendingRequests:{}}},mounted:function(){this.connectToWebsocket()},computed:{...(0,p.rn)(["isLoggedIn"]),currentUserId(){const e=JSON.parse(localStorage.getItem("user"));return e?e.userID:null},filteredOpenChats(){return Array.isArray(this.followRelations)?this.followRelations.filter((e=>this.openChats[e.RoomID])):[]}},watch:{notifications:{handler(e,s){console.log("Notifications changed",e,s)},deep:!0}},methods:{...(0,p.nv)(["logOut"]),handleLogout(){this.$axios.post("/api/logout").then((()=>{this.logOut(),this.$cookies.remove("session_id"),localStorage.clear(),this.$router.push("/welcome")})).catch((e=>{console.error("Logout failed:",e)}))},handleUserClick(e){console.log("Opening chat for room:",e.RoomID),this.currentRoomId=e.RoomID,this.currentRelationUserId=e.UserID,this.unreadMessagesCount[e.RoomID]=0,this.followRelations=this.followRelations.map((s=>s.RoomID===e.RoomID?{...s,UnreadCount:0}:s)),this.fetchMessages(e.RoomID),void 0===this.openChats[e.RoomID]?this.openChats[e.RoomID]=!0:this.openChats[e.RoomID]=!this.openChats[e.RoomID]},connectToWebsocket(){console.log("Attempting to connect to WebSocket"),this.ws=new WebSocket(this.serverUrl),this.ws.addEventListener("open",this.onWebsocketOpen),this.ws.addEventListener("message",(e=>{this.handleNewMessage(e)})),this.ws.addEventListener("error",this.onWebsocketError),this.ws.addEventListener("close",this.onWebsocketClose)},onWebsocketOpen(){console.log("Connected to WS!")},onWebsocketError(e){console.error("WebSocket Error: ",e)},onWebsocketClose(){console.log("WebSocket connection closed")},handleNewMessage(e){console.log("Received WebSocket message:",e.data);const s=e.data.split("\n").filter((e=>e.trim()));let o;if(s.forEach((e=>{try{switch(o=JSON.parse(e),o.type){case"chatMessage":o.payload.roomId===this.currentRoomId?this.messages.push(o.payload):this.openChats[o.payload.roomId]||this.updateUnreadCount(o.payload.roomId);break;case"fetchMessagesResponse":if(console.log("Fetched messages:",o.payload),o.payload.roomId===this.currentRoomId&&o.payload.messages&&o.payload.messages.length>0){const e=o.payload.messages.reverse();this.messages=[...e,...this.messages]}break;case"eventInviteResponse":console.log("Event invite response payload:",o.payload),Array.isArray(o.payload)?o.payload.forEach((e=>{const s=this.notifications.findIndex((s=>"eventInvite"===s.type&&s.responseId===e.responseId));-1===s?this.notifications.push({type:"eventInvite",...e}):this.notifications[s]={...this.notifications[s],...e}})):o.payload.message&&(this.notificationMessage=o.payload.message);break;case"groupInviteResponse":console.log("Group invite response payload:",o.payload),Array.isArray(o.payload)?o.payload.forEach((e=>{const s={type:"groupInvite",groupId:e.GroupID,groupName:e.Name,groupDescription:e.Description,creatorUserId:e.CreatorUserID,creatorName:e.CreatorName},o=this.notifications.findIndex((s=>"groupInvite"===s.type&&s.groupId===e.GroupID));-1===o?this.notifications.push(s):this.notifications[o]={...this.notifications[o],...s}})):o.payload.message&&(this.notificationMessage=o.payload.message);break;case"followRequestResponse":console.log("Follow request payload:",o.payload),Array.isArray(o.payload)&&o.payload.forEach((e=>{const s={type:"followRequest",followerUserId:e.followerUserId,firstName:e.firstName,lastName:e.lastName},o=this.notifications.findIndex((s=>"followRequest"===s.type&&s.followerUserId===e.followerUserId));-1===o?this.notifications.push(s):this.notifications[o]={...this.notifications[o],...s}}));break;case"groupJoinRequestResponse":console.log("Group join request payload:",o.payload),Array.isArray(o.payload)&&o.payload.forEach((e=>{const s={type:"groupJoinRequest",requestId:e.requestId,groupId:e.groupId,groupName:e.groupName,requesterUserId:e.userId,LastName:e.lastName,FirstName:e.firstName};this.notifications.push(s)}));break}}catch(s){console.error("Error parsing individual message:",s)}})),o.userRelations){console.log("User relations received:",o.userRelations);const e=Object.values(o.userRelations);localStorage.setItem("userRelations",JSON.stringify(e)),this.loadUserRelations()}o.followingMap&&(console.log("Following map received:",o.followingMap),localStorage.setItem("followingMap",JSON.stringify(o.followingMap))),o.followersMap&&(console.log("Followers map received:",o.followersMap),localStorage.setItem("followersMap",JSON.stringify(o.followersMap))),o.pendingRequests&&(console.log("Requests map received:",o.pendingRequests),localStorage.setItem("pendingRequests",JSON.stringify(o.pendingRequests))),o.userGroups&&(console.log("User groups received:",o.userGroups),localStorage.setItem("userGroups",JSON.stringify(o.userGroups))),o.groupJoinRequests&&(console.log("Group join requests received:",o.groupJoinRequests),localStorage.setItem("groupJoinRequests",JSON.stringify(o.groupJoinRequests)))},updateUnreadCount(e){this.unreadMessagesCount[e]=(this.unreadMessagesCount[e]||0)+1,this.followRelations=this.followRelations.map((s=>s.RoomID===e?{...s,UnreadCount:this.unreadMessagesCount[e]}:s))},loadUserRelations(){const e=localStorage.getItem("userRelations");if(e)try{const s=JSON.parse(e);this.followRelations=s.map((e=>(void 0===this.unreadMessagesCount[e.RoomID]&&(this.unreadMessagesCount[e.RoomID]=e.UnreadCount||0),{...e,UnreadCount:this.unreadMessagesCount[e.RoomID]}))),this.loadingFollowRelations=!1}catch(s){console.error("Error parsing followRelations from localStorage:",s)}else console.log("No followRelations found in localStorage"),this.followRelations=[],this.loadingFollowRelations=!1},sendChatMessage(e,s){const o=JSON.parse(localStorage.getItem("user")),t=o.userID,i=new Date;let n={type:"chatMessage",payload:{senderUserId:t,receiverUserId:this.currentRelationUserId,content:e,roomId:s,timestamp:i.toISOString()}};console.log("Sending chat message with timestamp:",n),this.ws.send(JSON.stringify(n))},fetchMessages(e){let s={type:"fetchMessages",payload:{roomId:e}};console.log("Fetching messages for room:",e),this.ws.send(JSON.stringify(s))},handleCloseChat(e){void 0!==this.openChats[e]&&(this.openChats[e]=!1,this.messages=[])},toggleNotificationCenter(){if(this.isNotificationCenterVisible=!this.isNotificationCenterVisible,this.isNotificationCenterVisible){const e=["eventInvite","groupInvite","followRequestCheck","groupJoinRequestCheck"];e.forEach((e=>{const s={type:e,payload:{userId:this.currentUserId}};console.log("Notifications payload for "+e+":",s),this.ws.send(JSON.stringify(s))}))}},handleResponse(e,s,o){let t;"event"===o?t={type:"eInviteResponse",payload:{responseId:e.responseId,userId:this.currentUserId,response:s}}:"group"===o?t={type:"gInviteResponse",payload:{groupId:e.groupId,userId:this.currentUserId,accept:s}}:"follow"===o?(t={type:s?"acceptFollowRequest":"declineFollowRequest",payload:{userId:this.currentUserId,followerUserId:e.followerUserId}},this.ws.send(JSON.stringify(t)),this.notifications=this.notifications.filter((s=>"followRequest"!==s.type||s.followerUserId!==e.followerUserId))):"groupJoinRequest"===o&&(t={type:s?"acceptGroupJoinRequest":"declineGroupJoinRequest",payload:{userId:this.currentUserId,requestId:e.requestId}}),console.log(`${o} response payload going to backend`,t),this.ws.send(JSON.stringify(t)),"groupJoinRequest"===o?this.notifications=this.notifications.filter((s=>s.requestId!==e.requestId)):"event"!==o&&"group"!==o||(this.notifications=this.notifications.filter((s=>"event"===o?s.responseId!==e.responseId:s.groupId!==e.groupId)))}}};const Ys=(0,l.Z)(Ts,[["render",Pe]]);var Hs=Ys;const Ks=e=>((0,i.dD)("data-v-6a92fc40"),e=e(),(0,i.Cn)(),e),Bs={class:"groups-page"},Zs=Ks((()=>(0,i._)("div",{class:"header-element-wrapper"},null,-1))),Qs={class:"header-element-wrapper"},Xs={class:"navbar"},eo={class:"header-element-wrapper"},so={class:"main-container"},oo={class:"content-wrapper"},to={class:"groups-content"},io=Ks((()=>(0,i._)("h2",null,"Available Groups",-1))),no={class:"group-list-container"},ro={class:"group-title"},ao={class:"group-description"},lo={class:"action-buttons"},co=["onClick"],uo={key:1,class:"pending-btn",disabled:""},po=["onClick"],go=["onClick"],ho={class:"chat-windows-container"},mo={class:"user-list"},fo=Ks((()=>(0,i._)("h2",null,"Contacts",-1))),wo=["onClick"],Io=["src"],vo={key:0,class:"unread-indicator"},yo={class:"left-sidebar"},Uo={class:"left-sidebar-button-container"},ko={class:"action-buttons-left-sidebar"},Co={class:"create-group-sidebar-header"},_o=Ks((()=>(0,i._)("span",{class:"sidebar-back"},[(0,i._)("svg",{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:"512.000000pt",height:"512.000000pt",viewBox:"0 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet"},[(0,i._)("g",{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",fill:"#000000",stroke:"none"},[(0,i._)("path",{d:"M2058 4727 c-31 -13 -74 -38 -95 -55 -77 -62 -1882 -1878 -1907\n                  -1920 -38 -61 -60 -154 -52 -225 14 -132 -40 -73 1014 -1129 795 -796 975\n                  -971 1020 -994 78 -39 202 -46 285 -14 89 34 153 90 191 169 28 60 31 75 31\n                  161 0 165 16 144 -562 729 -274 278 -534 536 -579 575 -45 40 -118 91 -167\n                  116 l-86 45 1837 5 1837 5 57 23 c81 33 160 108 200 190 30 60 33 75 33 152\n                  -1 70 -5 95 -27 142 -35 76 -99 143 -173 181 l-60 32 -1855 5 -1855 5 95 50\n                  95 49 576 576 c665 664 634 624 634 795 0 89 -3 106 -28 156 -15 31 -50 78\n                  -77 103 -72 68 -126 89 -235 93 -77 3 -98 0 -147 -20z"})])])],-1))),bo=[_o],Ro=Ks((()=>(0,i._)("h2",null,"Create New Group",-1))),Do={class:"create-group-body"},No={class:"form-group"},So=Ks((()=>(0,i._)("label",{for:"groupName"},"Group Name:",-1))),qo={class:"form-group"},Mo=Ks((()=>(0,i._)("label",{for:"groupDescription"},"Description:",-1))),Po=Ks((()=>(0,i._)("label",null,"User Invitations:",-1))),Oo={class:"user-invitation-list"},Eo=["id","value"],Jo=["for"],Go=Ks((()=>(0,i._)("button",{type:"submit"},"Create Group",-1))),zo={class:"notification-center-header"},Fo=Ks((()=>(0,i._)("span",{class:"sidebar-back"},[(0,i._)("svg",{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:"512.000000pt",height:"512.000000pt",viewBox:"0 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet"},[(0,i._)("g",{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",fill:"#000000",stroke:"none"},[(0,i._)("path",{d:"M2058 4727 c-31 -13 -74 -38 -95 -55 -77 -62 -1882 -1878 -1907\n                  -1920 -38 -61 -60 -154 -52 -225 14 -132 -40 -73 1014 -1129 795 -796 975\n                  -971 1020 -994 78 -39 202 -46 285 -14 89 34 153 90 191 169 28 60 31 75 31\n                  161 0 165 16 144 -562 729 -274 278 -534 536 -579 575 -45 40 -118 91 -167\n                  116 l-86 45 1837 5 1837 5 57 23 c81 33 160 108 200 190 30 60 33 75 33 152\n                  -1 70 -5 95 -27 142 -35 76 -99 143 -173 181 l-60 32 -1855 5 -1855 5 95 50\n                  95 49 576 576 c665 664 634 624 634 795 0 89 -3 106 -28 156 -15 31 -50 78\n                  -77 103 -72 68 -126 89 -235 93 -77 3 -98 0 -147 -20z"})])])],-1))),Lo=[Fo],Ao=Ks((()=>(0,i._)("h2",null,"Notifications",-1))),Wo={class:"notification-list"},xo={key:0},$o={key:0,class:"notification-message"},jo={class:"event-invite-message"},Vo={class:"response-buttons"},To=["onClick"],Yo=["onClick"],Ho={key:1},Ko={class:"group-invite-message"},Bo={class:"response-buttons"},Zo=["onClick"],Qo=["onClick"],Xo={key:2},et={class:"follow-request-message"},st={class:"response-buttons"},ot=["onClick"],tt=["onClick"],it={key:3},nt={class:"group-join-request-message"},rt={class:"response-buttons"},at=["onClick"],lt=["onClick"];function ct(e,s,o,n,r,a){const l=(0,i.up)("router-link"),c=(0,i.up)("ChatWindow");return(0,i.wg)(),(0,i.iD)("div",Bs,[(0,i._)("header",null,[Zs,(0,i._)("div",Qs,[(0,i._)("nav",Xs,[(0,i.Wm)(l,{to:"/",class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("HOME")])),_:1}),(0,i.Wm)(l,{to:"/groups",class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("GROUPS")])),_:1}),(0,i.Wm)(l,{to:"/users",class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("USERS")])),_:1}),(0,i.Wm)(l,{to:"/profile",class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("PROFILE")])),_:1})])]),(0,i._)("div",eo,[(0,i._)("button",{onClick:s[0]||(s[0]=(...e)=>a.handleLogout&&a.handleLogout(...e))},"Log Out")])]),(0,i._)("div",so,[(0,i._)("div",oo,[(0,i._)("section",to,[io,(0,i._)("div",no,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.groups,(e=>((0,i.wg)(),(0,i.iD)("div",{class:"group-card",key:e.groupId},[(0,i._)("h3",ro,(0,m.zw)(e.name),1),(0,i._)("p",ao,(0,m.zw)(e.description),1),(0,i._)("div",lo,[a.isUserPartOfGroup(e.groupId)||a.isJoinRequestPending(e.groupId)?a.isJoinRequestPending(e.groupId)?((0,i.wg)(),(0,i.iD)("button",uo,"Pending")):a.isUserPartOfGroup(e.groupId)?((0,i.wg)(),(0,i.iD)("button",{key:2,class:"leave-btn",onClick:s=>a.leaveGroup(e.groupId)},"Leave",8,po)):(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("button",{key:0,class:"join-btn",onClick:s=>a.joinGroup(e.groupId)},"Join This Group",8,co)),(0,i._)("button",{class:"details-btn",onClick:s=>a.navigateToGroup(e.groupId)},"View Details",8,go)])])))),128))]),(0,i._)("div",ho,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.filteredOpenChats,(e=>((0,i.wg)(),(0,i.j4)(c,{key:e.RoomID,currentRoomId:e.RoomID,messages:r.messages.filter((s=>s.roomId===e.RoomID)),currentUserId:a.currentUserId,sendMessageFunction:a.sendChatMessage,onCloseChat:a.handleCloseChat,class:"chat-window"},null,8,["currentRoomId","messages","currentUserId","sendMessageFunction","onCloseChat"])))),128))])]),(0,i._)("aside",mo,[fo,(0,i._)("ul",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.followRelations,(e=>((0,i.wg)(),(0,i.iD)("li",{key:e.UserID,onClick:s=>a.handleUserClick(e)},[(0,i._)("img",{src:e.profilePicture||r.defaultProfilePic,alt:"Profile Image",class:"profile-image"},null,8,Io),(0,i.Uk)(" "+(0,m.zw)(e.FirstName+" "+e.LastName)+" ",1),e.UnreadCount?((0,i.wg)(),(0,i.iD)("span",vo,(0,m.zw)(e.UnreadCount),1)):(0,i.kq)("",!0)],8,wo)))),128))])]),(0,i._)("aside",yo,[(0,i._)("div",Uo,[(0,i._)("div",ko,[(0,i._)("button",{onClick:s[1]||(s[1]=e=>a.toggleNotificationCenter())},"Notification Center"),(0,i._)("button",{onClick:s[2]||(s[2]=e=>r.isSidebarVisible=!r.isSidebarVisible)},"Create New Group")])])]),(0,i._)("aside",{class:(0,m.C_)(["create-group-form",{"is-visible":r.isSidebarVisible}])},[(0,i._)("div",Co,[(0,i._)("button",{onClick:s[3]||(s[3]=e=>r.isSidebarVisible=!1)},bo),Ro]),(0,i._)("div",Do,[(0,i._)("form",{onSubmit:s[7]||(s[7]=(0,t.iM)(((...e)=>a.submitGroup&&a.submitGroup(...e)),["prevent"]))},[(0,i._)("div",No,[So,(0,i.wy)((0,i._)("input",{type:"text",id:"groupName","onUpdate:modelValue":s[4]||(s[4]=e=>r.groupName=e),required:""},null,512),[[t.nr,r.groupName]])]),(0,i._)("div",qo,[Mo,(0,i.wy)((0,i._)("textarea",{id:"groupDescription","onUpdate:modelValue":s[5]||(s[5]=e=>r.groupDescription=e),rows:"5",required:""},null,512),[[t.nr,r.groupDescription]])]),Po,(0,i._)("ul",Oo,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.availableUsers,(e=>((0,i.wg)(),(0,i.iD)("li",{key:e.userID},[(0,i.wy)((0,i._)("input",{type:"checkbox",id:`invite-${e.userID}`,value:e.userID,"onUpdate:modelValue":s[6]||(s[6]=e=>r.selectedUserIds=e)},null,8,Eo),[[t.e8,r.selectedUserIds]]),(0,i._)("label",{for:`invite-${e.userID}`},(0,m.zw)(e.firstName+" "+e.lastName),9,Jo)])))),128))]),Go],32)])],2),(0,i._)("aside",{class:(0,m.C_)(["notification-center",{"is-visible":r.isNotificationCenterVisible}])},[(0,i._)("div",zo,[(0,i._)("button",{onClick:s[8]||(s[8]=e=>{r.isNotificationCenterVisible=!1,r.notifications=[]})},Lo),Ao]),(0,i._)("div",Wo,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.notifications,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.id,class:"notification"},["eventInvite"===e.type?((0,i.wg)(),(0,i.iD)("div",xo,[r.notificationMessage?((0,i.wg)(),(0,i.iD)("div",$o,(0,m.zw)(r.notificationMessage),1)):(0,i.kq)("",!0),(0,i._)("p",jo,[(0,i.Uk)(" You have been invited to "),(0,i._)("strong",null,(0,m.zw)(e.groupName),1),(0,i.Uk)(" event "),(0,i._)("strong",null,'"'+(0,m.zw)(e.title)+'"',1),(0,i.Uk)(" by "),(0,i._)("strong",null,(0,m.zw)(e.creatorFirstName)+" "+(0,m.zw)(e.creatorLastName),1)]),(0,i._)("div",Vo,[(0,i._)("button",{class:"going",onClick:s=>a.handleResponse(e,"Going","event")},"Going",8,To),(0,i._)("button",{class:"notGoing",onClick:s=>a.handleResponse(e,"Not Going","event")},"Not Going",8,Yo)])])):"groupInvite"===e.type?((0,i.wg)(),(0,i.iD)("div",Ho,[(0,i._)("p",Ko,[(0,i.Uk)(" You have been invited to join the group "),(0,i._)("strong",null,'"'+(0,m.zw)(e.groupName)+'"',1),(0,i.Uk)(" by "),(0,i._)("strong",null,(0,m.zw)(e.creatorName),1),(0,i.Uk)(". ")]),(0,i._)("div",Bo,[(0,i._)("button",{class:"accept",onClick:s=>a.handleResponse(e,!0,"group")},"Accept",8,Zo),(0,i._)("button",{class:"decline",onClick:s=>a.handleResponse(e,!1,"group")},"Decline",8,Qo)])])):"followRequest"===e.type?((0,i.wg)(),(0,i.iD)("div",Xo,[(0,i._)("p",et,[(0,i._)("strong",null,(0,m.zw)(e.firstName)+" "+(0,m.zw)(e.lastName),1),(0,i.Uk)(" wants to follow you. ")]),(0,i._)("div",st,[(0,i._)("button",{class:"accept",onClick:s=>a.handleResponse(e,!0,"follow")},"Accept",8,ot),(0,i._)("button",{class:"decline",onClick:s=>a.handleResponse(e,!1,"follow")},"Decline",8,tt)])])):(0,i.kq)("",!0),"groupJoinRequest"===e.type?((0,i.wg)(),(0,i.iD)("div",it,[(0,i._)("p",nt,[(0,i._)("strong",null,(0,m.zw)(e.FirstName)+" "+(0,m.zw)(e.LastName),1),(0,i.Uk)(" wants to join your group "),(0,i._)("strong",null,'"'+(0,m.zw)(e.groupName)+'"',1),(0,i.Uk)(". ")]),(0,i._)("div",rt,[(0,i._)("button",{class:"accept",onClick:s=>a.handleResponse(e,!0,"groupJoinRequest")},"Accept",8,at),(0,i._)("button",{class:"decline",onClick:s=>a.handleResponse(e,!1,"groupJoinRequest")},"Decline",8,lt)])])):(0,i.kq)("",!0)])))),128))])],2)])])])}var ut={name:"GroupsPage",components:{ChatWindow:He},data(){return{defaultProfilePic:xs,ws:null,serverUrl:"ws://localhost:8091/ws",messages:[],newMessage:"",unreadMessagesCount:{},currentRoomId:null,openChats:{},followRelations:[],groupName:"",groupDescription:"",groups:[],availableUsers:[],selectedUserIds:[],isSidebarVisible:!1,isNotificationCenterVisible:!1,notifications:[],notificationMessage:"",userGroups:JSON.parse(localStorage.getItem("userGroups")||"{}"),groupJoinRequests:JSON.parse(localStorage.getItem("groupJoinRequests")||"{}")}},computed:{...(0,p.rn)(["isLoggedIn","currentUser"]),currentUserId(){const e=JSON.parse(localStorage.getItem("user"));return e?e.userID:null},filteredOpenChats(){return this.followRelations.filter((e=>this.openChats[e.RoomID]))},isUserPartOfGroup(){return e=>!!this.userGroups[e]},isJoinRequestPending(){return e=>!!this.groupJoinRequests[e]}},methods:{...(0,p.nv)(["logOut"]),handleLogout(){this.$axios.post("/api/logout").then((()=>{this.logOut(),this.$cookies.remove("session_id"),localStorage.clear(),this.$router.push("/welcome")})).catch((e=>{console.error("Logout failed:",e)}))},connectToWebsocket(){console.log("Attempting to connect to WebSocket"),this.ws=new WebSocket(this.serverUrl),this.ws.addEventListener("open",this.onWebsocketOpen),this.ws.addEventListener("message",(e=>{this.handleNewMessage(e)})),this.ws.addEventListener("error",this.onWebsocketError),this.ws.addEventListener("close",this.onWebsocketClose)},onWebsocketOpen(){console.log("Connected to WS!")},onWebsocketError(e){console.error("WebSocket Error: ",e)},onWebsocketClose(){console.log("WebSocket connection closed")},handleNewMessage(e){console.log("Received WebSocket message:",e.data);const s=e.data.split("\n").filter((e=>e.trim()));let o;if(s.forEach((e=>{try{switch(o=JSON.parse(e),o.type){case"chatMessage":o.payload.roomId===this.currentRoomId?this.messages.push(o.payload):this.openChats[o.payload.roomId]||this.updateUnreadCount(o.payload.roomId);break;case"fetchMessagesResponse":if(console.log("Fetched messages:",o.payload),o.payload.roomId===this.currentRoomId&&o.payload.messages&&o.payload.messages.length>0){const e=o.payload.messages.reverse();this.messages=[...e,...this.messages]}break;case"eventInviteResponse":console.log("Event invite response payload:",o.payload),Array.isArray(o.payload)?o.payload.forEach((e=>{const s=this.notifications.findIndex((s=>"eventInvite"===s.type&&s.responseId===e.responseId));-1===s?this.notifications.push({type:"eventInvite",...e}):this.notifications[s]={...this.notifications[s],...e}})):o.payload.message&&(this.notificationMessage=o.payload.message);break;case"groupInviteResponse":console.log("Group invite response payload:",o.payload),Array.isArray(o.payload)?o.payload.forEach((e=>{const s={type:"groupInvite",groupId:e.GroupID,groupName:e.Name,groupDescription:e.Description,creatorUserId:e.CreatorUserID,creatorName:e.CreatorName},o=this.notifications.findIndex((s=>"groupInvite"===s.type&&s.groupId===e.GroupID));-1===o?this.notifications.push(s):this.notifications[o]={...this.notifications[o],...s}})):o.payload.message&&(this.notificationMessage=o.payload.message);break;case"followRequestResponse":console.log("Follow request payload:",o.payload),Array.isArray(o.payload)&&o.payload.forEach((e=>{const s={type:"followRequest",followerUserId:e.followerUserId,firstName:e.firstName,lastName:e.lastName},o=this.notifications.findIndex((s=>"followRequest"===s.type&&s.followerUserId===e.followerUserId));-1===o?this.notifications.push(s):this.notifications[o]={...this.notifications[o],...s}}));break;case"groupJoinRequestResponse":console.log("Group join request payload:",o.payload),Array.isArray(o.payload)&&o.payload.forEach((e=>{const s={type:"groupJoinRequest",requestId:e.requestId,groupId:e.groupId,groupName:e.groupName,requesterUserId:e.userId,LastName:e.lastName,FirstName:e.firstName};this.notifications.push(s)}));break}}catch(s){console.error("Error parsing individual message:",s)}})),o.userRelations){console.log("User relations received:",o.userRelations);const e=Object.values(o.userRelations);localStorage.setItem("userRelations",JSON.stringify(e)),this.loadUserRelations()}o.followingMap&&(console.log("Following map received:",o.followingMap),localStorage.setItem("followingMap",JSON.stringify(o.followingMap))),o.followersMap&&(console.log("Followers map received:",o.followersMap),localStorage.setItem("followersMap",JSON.stringify(o.followersMap))),o.pendingRequests&&(console.log("Requests map received:",o.pendingRequests),localStorage.setItem("pendingRequests",JSON.stringify(o.pendingRequests))),o.userGroups&&(console.log("User groups received:",o.userGroups),localStorage.setItem("userGroups",JSON.stringify(o.userGroups))),o.groupJoinRequests&&(console.log("Group join requests received:",o.groupJoinRequests),localStorage.setItem("groupJoinRequests",JSON.stringify(o.groupJoinRequests)))},handleUserClick(e){console.log("Opening chat for room:",e.RoomID),this.currentRoomId=e.RoomID,this.currentRelationUserId=e.UserID,this.unreadMessagesCount[e.RoomID]=0,this.followRelations=this.followRelations.map((s=>s.RoomID===e.RoomID?{...s,UnreadCount:0}:s)),this.fetchMessages(e.RoomID),void 0===this.openChats[e.RoomID]?this.openChats[e.RoomID]=!0:this.openChats[e.RoomID]=!this.openChats[e.RoomID]},fetchMessages(e){let s={type:"fetchMessages",payload:{roomId:e}};console.log("Fetching messages for room:",e),this.ws.send(JSON.stringify(s))},sendChatMessage(e,s){const o=JSON.parse(localStorage.getItem("user")),t=o.userID,i=new Date;let n={type:"chatMessage",payload:{senderUserId:t,receiverUserId:this.currentRelationUserId,content:e,roomId:s,timestamp:i.toISOString()}};console.log("Sending chat message with timestamp:",n),this.ws.send(JSON.stringify(n))},handleCloseChat(e){void 0!==this.openChats[e]&&(this.openChats[e]=!1,this.messages=[])},updateUnreadCount(e){this.unreadMessagesCount[e]=(this.unreadMessagesCount[e]||0)+1,this.followRelations=this.followRelations.map((s=>s.RoomID===e?{...s,UnreadCount:this.unreadMessagesCount[e]}:s))},loadUserRelations(){const e=localStorage.getItem("userRelations");if(e)try{const s=JSON.parse(e);this.followRelations=s.map((e=>(void 0===this.unreadMessagesCount[e.RoomID]&&(this.unreadMessagesCount[e.RoomID]=e.UnreadCount||0),{...e,UnreadCount:this.unreadMessagesCount[e.RoomID]})))}catch(s){console.error("Error parsing followRelations from localStorage:",s)}else console.log("No followRelations found in localStorage"),this.followRelations=[]},submitGroup(){console.log("Submitting group data:",this.groupName,this.groupDescription,this.selectedUserIds);const e={group:{name:this.groupName,description:this.groupDescription},invitedUserIds:this.selectedUserIds};this.$axios.post("/api/createGroup",e).then((e=>{console.log("Group created:",e.data),this.groups.push(e.data);const s=e.data.groupId;this.userGroups[s]=!0,localStorage.setItem("userGroups",JSON.stringify(this.userGroups)),this.groupName="",this.groupDescription="",this.selectedUserIds=[],location.reload()})).catch((e=>{console.error("Error creating group:",e)}))},fetchGroups(){this.$axios.get("/api/groups").then((e=>{console.log("These are the fetched groups:",e),this.groups=e.data})).catch((e=>{console.error("Error fetching groups:",e)}))},fetchUsers(){this.$axios.get("/api/users").then((e=>{this.availableUsers=e.data,console.log("These are the users available:",this.availableUsers)})).catch((e=>{console.error("Error fetching users:",e)}))},navigateToGroup(e){console.log("Navigating to group:",e),this.$router.push({name:"GroupDetail",params:{groupId:e}})},joinGroup(e){const s=this.currentUserId;if(!s)return void alert("Please log in to join groups.");const o={userId:s,groupId:e};this.$axios.post("/api/joinGroup",o).then((s=>{console.log(s),alert("Request to join group has been sent.");let o=JSON.parse(localStorage.getItem("groupJoinRequests")||"{}");o[e]=!0,localStorage.setItem("groupJoinRequests",JSON.stringify(o)),this.$forceUpdate(),location.reload()})).catch((e=>{console.error("Error joining group:",e),alert("Failed to send join group request.")}))},leaveGroup(e){const s=this.currentUserId;if(!s)return void alert("Please log in to leave groups.");const o={userId:s,groupId:e};this.$axios.post("/api/leaveGroup",o).then((s=>{console.log(s),alert("You have left the group.");let o=JSON.parse(localStorage.getItem("userGroups")||"{}");delete o[e],localStorage.setItem("userGroups",JSON.stringify(o)),this.$forceUpdate(),location.reload()})).catch((e=>{console.error("Error leaving group:",e),alert("Failed to send leave group request.")}))},toggleNotificationCenter(){if(this.isNotificationCenterVisible=!this.isNotificationCenterVisible,this.isNotificationCenterVisible){const e=["eventInvite","groupInvite","followRequestCheck","groupJoinRequestCheck"];e.forEach((e=>{const s={type:e,payload:{userId:this.currentUserId}};console.log("Notifications payload for "+e+":",s),this.ws.send(JSON.stringify(s))}))}},handleResponse(e,s,o){let t;"event"===o?t={type:"eInviteResponse",payload:{responseId:e.responseId,userId:this.currentUserId,response:s}}:"group"===o?t={type:"gInviteResponse",payload:{groupId:e.groupId,userId:this.currentUserId,accept:s}}:"follow"===o?(t={type:s?"acceptFollowRequest":"declineFollowRequest",payload:{userId:this.currentUserId,followerUserId:e.followerUserId}},this.ws.send(JSON.stringify(t)),this.notifications=this.notifications.filter((s=>"followRequest"!==s.type||s.followerUserId!==e.followerUserId))):"groupJoinRequest"===o&&(t={type:s?"acceptGroupJoinRequest":"declineGroupJoinRequest",payload:{userId:this.currentUserId,requestId:e.requestId}}),console.log(`${o} response payload going to backend`,t),this.ws.send(JSON.stringify(t)),"groupJoinRequest"===o?this.notifications=this.notifications.filter((s=>s.requestId!==e.requestId)):"event"!==o&&"group"!==o||(this.notifications=this.notifications.filter((s=>"event"===o?s.responseId!==e.responseId:s.groupId!==e.groupId)))}},mounted(){this.connectToWebsocket(),this.fetchGroups(),this.fetchUsers()}};const dt=(0,l.Z)(ut,[["render",ct],["__scopeId","data-v-6a92fc40"]]);var pt=dt;const gt=e=>((0,i.dD)("data-v-1f2ff3cd"),e=e(),(0,i.Cn)(),e),ht=gt((()=>(0,i._)("div",{class:"header-element-wrapper"},null,-1))),mt={class:"header-element-wrapper"},ft={class:"navbar"},wt={class:"header-element-wrapper"},It={class:"main-container"},vt={class:"content-wrapper"},yt={class:"users-content"},Ut=gt((()=>(0,i._)("h1",null,"Users",-1))),kt={class:"users-page-container"},Ct={key:0,class:"user-card"},_t=["src"],bt={class:"user-name"},Rt=["onClick"],Dt=["onClick"],Nt=["onClick"],St=["onClick"],qt=["onClick"],Mt={key:4,class:"profile-privacy"},Pt={class:"chat-windows-container"},Ot={class:"user-list"},Et=gt((()=>(0,i._)("h2",null,"Contacts",-1))),Jt=["onClick"],Gt=["src"],zt={key:0,class:"unread-indicator"},Ft={class:"left-sidebar"},Lt={class:"action-buttons-left-sidebar"},At={class:"notification-center-header"},Wt=gt((()=>(0,i._)("span",{class:"sidebar-back"},[(0,i._)("svg",{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:"512.000000pt",height:"512.000000pt",viewBox:"0 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet"},[(0,i._)("g",{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",fill:"#000000",stroke:"none"},[(0,i._)("path",{d:"M2058 4727 c-31 -13 -74 -38 -95 -55 -77 -62 -1882 -1878 -1907\n                -1920 -38 -61 -60 -154 -52 -225 14 -132 -40 -73 1014 -1129 795 -796 975\n                -971 1020 -994 78 -39 202 -46 285 -14 89 34 153 90 191 169 28 60 31 75 31\n                161 0 165 16 144 -562 729 -274 278 -534 536 -579 575 -45 40 -118 91 -167\n                116 l-86 45 1837 5 1837 5 57 23 c81 33 160 108 200 190 30 60 33 75 33 152\n                -1 70 -5 95 -27 142 -35 76 -99 143 -173 181 l-60 32 -1855 5 -1855 5 95 50\n                95 49 576 576 c665 664 634 624 634 795 0 89 -3 106 -28 156 -15 31 -50 78\n                -77 103 -72 68 -126 89 -235 93 -77 3 -98 0 -147 -20z"})])])],-1))),xt=[Wt],$t=gt((()=>(0,i._)("h2",null,"Notifications",-1))),jt={class:"notification-list"},Vt={key:0},Tt={key:0,class:"notification-message"},Yt={class:"event-invite-message"},Ht={class:"response-buttons"},Kt=["onClick"],Bt=["onClick"],Zt={key:1},Qt={class:"group-invite-message"},Xt={class:"response-buttons"},ei=["onClick"],si=["onClick"],oi={key:2},ti={class:"follow-request-message"},ii={class:"response-buttons"},ni=["onClick"],ri=["onClick"],ai={key:3},li={class:"group-join-request-message"},ci={class:"response-buttons"},ui=["onClick"],di=["onClick"];function pi(e,s,o,t,n,r){const a=(0,i.up)("router-link"),l=(0,i.up)("ChatWindow");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("header",null,[ht,(0,i._)("div",mt,[(0,i._)("nav",ft,[(0,i.Wm)(a,{to:"/",class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("HOME")])),_:1}),(0,i.Wm)(a,{to:"/groups",class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("GROUPS")])),_:1}),(0,i.Wm)(a,{to:"/users",class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("USERS")])),_:1}),(0,i.Wm)(a,{to:`/profile/${r.currentUserId}`,class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("PROFILE")])),_:1},8,["to"])])]),(0,i._)("div",wt,[(0,i._)("button",{onClick:s[0]||(s[0]=(...e)=>r.handleLogout&&r.handleLogout(...e))},"Log Out")])]),(0,i._)("div",It,[(0,i._)("div",vt,[(0,i._)("section",yt,[Ut,(0,i._)("div",kt,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.users,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.userID},[e.userID!==r.currentUserId?((0,i.wg)(),(0,i.iD)("div",Ct,[(0,i._)("img",{src:e.profilePicture||n.defaultProfilePic,alt:"Profile Picture"},null,8,_t),(0,i._)("div",bt,(0,m.zw)(e.firstName)+" "+(0,m.zw)(e.lastName),1),r.isFollowing(e.userID)||r.isFollower(e.userID)||r.isPending(e.userID)?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("button",{key:0,onClick:s=>r.followUser(e.userID),class:"follow-btn"},"Follow",8,Rt)),r.isFollowing(e.userID)||!r.isFollower(e.userID)||r.isPending(e.userID)?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("button",{key:1,onClick:s=>r.followUser(e.userID),class:"follow-btn"},"Follow Back",8,Dt)),r.isPending(e.userID)?((0,i.wg)(),(0,i.iD)("button",{key:2,onClick:s=>r.cancelFollowRequest(e.userID),class:"pending-btn"},"Pending",8,Nt)):(0,i.kq)("",!0),r.isFollowing(e.userID)?((0,i.wg)(),(0,i.iD)("button",{key:3,onClick:s=>r.unfollowUser(e.userID),class:"unfollow-btn"},"Unfollow",8,St)):(0,i.kq)("",!0),(0,i._)("button",{onClick:s=>r.navigateToUserProfile(e.userID),class:"details-button"},"View Profile",8,qt),"Private"===e.profilePrivacy?((0,i.wg)(),(0,i.iD)("div",Mt,"Private Profile")):(0,i.kq)("",!0)])):(0,i.kq)("",!0)])))),128))]),(0,i._)("div",Pt,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.filteredOpenChats,(e=>((0,i.wg)(),(0,i.j4)(l,{key:e.RoomID,currentRoomId:e.RoomID,messages:n.messages.filter((s=>s.roomId===e.RoomID)),currentUserId:r.currentUserId,sendMessageFunction:r.sendChatMessage,onCloseChat:r.handleCloseChat,class:"chat-window"},null,8,["currentRoomId","messages","currentUserId","sendMessageFunction","onCloseChat"])))),128))]),(0,i._)("aside",Ot,[Et,(0,i._)("ul",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.followRelations,(e=>((0,i.wg)(),(0,i.iD)("li",{key:e.UserID,onClick:s=>r.handleUserClick(e)},[(0,i._)("img",{src:e.profilePicture||n.defaultProfilePic,alt:"Profile Image",class:"profile-image"},null,8,Gt),(0,i.Uk)(" "+(0,m.zw)(e.FirstName+" "+e.LastName)+" ",1),e.UnreadCount?((0,i.wg)(),(0,i.iD)("span",zt,(0,m.zw)(e.UnreadCount),1)):(0,i.kq)("",!0)],8,Jt)))),128))])]),(0,i._)("aside",Ft,[(0,i._)("div",Lt,[(0,i._)("button",{onClick:s[1]||(s[1]=e=>r.toggleNotificationCenter())},"Notification Center")])]),(0,i._)("aside",{class:(0,m.C_)(["notification-center",{"is-visible":n.isNotificationCenterVisible}])},[(0,i._)("div",At,[(0,i._)("button",{onClick:s[2]||(s[2]=e=>{n.isNotificationCenterVisible=!1,n.notifications=[]})},xt),$t]),(0,i._)("div",jt,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.notifications,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.id,class:"notification"},["eventInvite"===e.type?((0,i.wg)(),(0,i.iD)("div",Vt,[n.notificationMessage?((0,i.wg)(),(0,i.iD)("div",Tt,(0,m.zw)(n.notificationMessage),1)):(0,i.kq)("",!0),(0,i._)("p",Yt,[(0,i.Uk)(" You have been invited to "),(0,i._)("strong",null,(0,m.zw)(e.groupName),1),(0,i.Uk)(" event "),(0,i._)("strong",null,'"'+(0,m.zw)(e.title)+'"',1),(0,i.Uk)(" by "),(0,i._)("strong",null,(0,m.zw)(e.creatorFirstName)+" "+(0,m.zw)(e.creatorLastName),1)]),(0,i._)("div",Ht,[(0,i._)("button",{class:"going",onClick:s=>r.handleResponse(e,"Going","event")},"Going",8,Kt),(0,i._)("button",{class:"notGoing",onClick:s=>r.handleResponse(e,"Not Going","event")},"Not Going",8,Bt)])])):"groupInvite"===e.type?((0,i.wg)(),(0,i.iD)("div",Zt,[(0,i._)("p",Qt,[(0,i.Uk)(" You have been invited to join the group "),(0,i._)("strong",null,'"'+(0,m.zw)(e.groupName)+'"',1),(0,i.Uk)(" by "),(0,i._)("strong",null,(0,m.zw)(e.creatorName),1),(0,i.Uk)(". ")]),(0,i._)("div",Xt,[(0,i._)("button",{class:"accept",onClick:s=>r.handleResponse(e,!0,"group")},"Accept",8,ei),(0,i._)("button",{class:"decline",onClick:s=>r.handleResponse(e,!1,"group")},"Decline",8,si)])])):"followRequest"===e.type?((0,i.wg)(),(0,i.iD)("div",oi,[(0,i._)("p",ti,[(0,i._)("strong",null,(0,m.zw)(e.firstName)+" "+(0,m.zw)(e.lastName),1),(0,i.Uk)(" wants to follow you. ")]),(0,i._)("div",ii,[(0,i._)("button",{class:"accept",onClick:s=>r.handleResponse(e,!0,"follow")},"Accept",8,ni),(0,i._)("button",{class:"decline",onClick:s=>r.handleResponse(e,!1,"follow")},"Decline",8,ri)])])):(0,i.kq)("",!0),"groupJoinRequest"===e.type?((0,i.wg)(),(0,i.iD)("div",ai,[(0,i._)("p",li,[(0,i._)("strong",null,(0,m.zw)(e.FirstName)+" "+(0,m.zw)(e.LastName),1),(0,i.Uk)(" wants to join your group "),(0,i._)("strong",null,'"'+(0,m.zw)(e.groupName)+'"',1),(0,i.Uk)(". ")]),(0,i._)("div",ci,[(0,i._)("button",{class:"accept",onClick:s=>r.handleResponse(e,!0,"groupJoinRequest")},"Accept",8,ui),(0,i._)("button",{class:"decline",onClick:s=>r.handleResponse(e,!1,"groupJoinRequest")},"Decline",8,di)])])):(0,i.kq)("",!0)])))),128))])],2)])])])],64)}var gi={name:"UsersPage",components:{ChatWindow:He},data(){return{users:[],isSidebarVisible:!1,availableUsers:[],selectedUserIds:[],groupName:"",groupDescription:"",followRelations:[],defaultProfilePic:xs,ws:null,serverUrl:"ws://localhost:8091/ws",messages:[],unreadMessagesCount:{},newMessage:"",currentRoomId:null,openChats:{},followingMap:JSON.parse(localStorage.getItem("followingMap")||"{}"),followersMap:JSON.parse(localStorage.getItem("followersMap")||"{}"),pendingRequestsMap:JSON.parse(localStorage.getItem("pendingRequests")||"{}"),notifications:[],notificationMessage:"",isNotificationCenterVisible:!1}},mounted:function(){this.connectToWebsocket(),this.loadUserRelations(),this.fetchUsers()},computed:{...(0,p.rn)(["isLoggedIn"]),currentUserId(){const e=JSON.parse(localStorage.getItem("user"));return e?e.userID:null},filteredOpenChats(){return Array.isArray(this.followRelations)?this.followRelations.filter((e=>this.openChats[e.RoomID])):[]},isFollowing(){return e=>this.followingMap[this.currentUserId]?.includes(e)},isFollower(){return e=>this.followersMap[e]?.includes(this.currentUserId)},isPending(){return e=>"pending"===this.pendingRequestsMap[e]}},created(){this.connectToWebsocket()},watch:{users:{handler(e,s){console.log("Users ARRAY changed",e,s)},deep:!0}},methods:{...(0,p.nv)(["logOut"]),handleLogout(){this.$axios.post("/api/logout").then((()=>{this.logOut(),this.$cookies.remove("session_id"),localStorage.clear(),this.$router.push("/welcome")})).catch((e=>{console.error("Logout failed:",e)}))},navigateToUserProfile(e){this.$router.push({name:"ProfilePage",params:{userId:e}})},handleUserClick(e){console.log("Opening chat for room:",e.RoomID),this.currentRoomId=e.RoomID,this.currentRelationUserId=e.UserID,this.unreadMessagesCount[e.RoomID]=0,this.followRelations=this.followRelations.map((s=>s.RoomID===e.RoomID?{...s,UnreadCount:0}:s)),this.fetchMessages(e.RoomID),void 0===this.openChats[e.RoomID]?this.openChats[e.RoomID]=!0:this.openChats[e.RoomID]=!this.openChats[e.RoomID]},connectToWebsocket(){console.log("Attempting to connect to WebSocket"),this.ws=new WebSocket(this.serverUrl),this.ws.addEventListener("open",this.onWebsocketOpen),this.ws.addEventListener("message",(e=>{this.handleNewMessage(e)})),this.ws.addEventListener("error",this.onWebsocketError),this.ws.addEventListener("close",this.onWebsocketClose)},onWebsocketOpen(){console.log("Connected to WS!")},onWebsocketError(e){console.error("WebSocket Error: ",e)},onWebsocketClose(){console.log("WebSocket connection closed")},handleNewMessage(e){console.log("Received WebSocket message:",e.data);const s=e.data.split("\n").filter((e=>e.trim()));let o;if(s.forEach((e=>{try{switch(o=JSON.parse(e),o.type){case"followRequestAccepted":o.payload.targetUserId===this.currentUserId&&(this.followingMap[this.currentUserId].push(o.payload.requesterUserId),delete this.pendingRequestsMap[o.payload.requesterUserId]);break;case"followRequestDenied":delete this.pendingRequestsMap[o.payload.requesterUserId];break;case"chatMessage":o.payload.roomId===this.currentRoomId?this.messages.push(o.payload):this.openChats[o.payload.roomId]||this.updateUnreadCount(o.payload.roomId);break;case"fetchMessagesResponse":if(console.log("Fetched messages:",o.payload),o.payload.roomId===this.currentRoomId&&o.payload.messages&&o.payload.messages.length>0){const e=o.payload.messages.reverse();this.messages=[...e,...this.messages]}break;case"eventInviteResponse":console.log("Event invite response payload:",o.payload),Array.isArray(o.payload)?o.payload.forEach((e=>{const s=this.notifications.findIndex((s=>"eventInvite"===s.type&&s.responseId===e.responseId));-1===s?this.notifications.push({type:"eventInvite",...e}):this.notifications[s]={...this.notifications[s],...e}})):o.payload.message&&(this.notificationMessage=o.payload.message);break;case"groupInviteResponse":console.log("Group invite response payload:",o.payload),Array.isArray(o.payload)?o.payload.forEach((e=>{const s={type:"groupInvite",groupId:e.GroupID,groupName:e.Name,groupDescription:e.Description,creatorUserId:e.CreatorUserID,creatorName:e.CreatorName},o=this.notifications.findIndex((s=>"groupInvite"===s.type&&s.groupId===e.GroupID));-1===o?this.notifications.push(s):this.notifications[o]={...this.notifications[o],...s}})):o.payload.message&&(this.notificationMessage=o.payload.message);break;case"followRequestResponse":console.log("Follow request payload:",o.payload),Array.isArray(o.payload)&&o.payload.forEach((e=>{const s={type:"followRequest",followerUserId:e.followerUserId,firstName:e.firstName,lastName:e.lastName},o=this.notifications.findIndex((s=>"followRequest"===s.type&&s.followerUserId===e.followerUserId));-1===o?this.notifications.push(s):this.notifications[o]={...this.notifications[o],...s}}));break;case"groupJoinRequestResponse":console.log("Group join request payload:",o.payload),Array.isArray(o.payload)&&o.payload.forEach((e=>{const s={type:"groupJoinRequest",requestId:e.requestId,groupId:e.groupId,groupName:e.groupName,requesterUserId:e.userId,LastName:e.lastName,FirstName:e.firstName};this.notifications.push(s)}));break}}catch(s){console.error("Error parsing individual message:",s)}})),localStorage.setItem("followingMap",JSON.stringify(this.followingMap)),localStorage.setItem("pendingRequests",JSON.stringify(this.pendingRequestsMap)),this.fetchUsers(),o.userRelations){console.log("User relations received:",o.userRelations);const e=Object.values(o.userRelations);localStorage.setItem("userRelations",JSON.stringify(e)),this.loadUserRelations()}o.followingMap&&(console.log("Following map received:",o.followingMap),localStorage.setItem("followingMap",JSON.stringify(o.followingMap))),o.followersMap&&(console.log("Followers map received:",o.followersMap),localStorage.setItem("followersMap",JSON.stringify(o.followersMap))),o.pendingRequests&&(console.log("Requests map received:",o.pendingRequests),localStorage.setItem("pendingRequests",JSON.stringify(o.pendingRequests))),o.userGroups&&(console.log("User groups received:",o.userGroups),localStorage.setItem("userGroups",JSON.stringify(o.userGroups))),o.groupJoinRequests&&(console.log("Group join requests received:",o.groupJoinRequests),localStorage.setItem("groupJoinRequests",JSON.stringify(o.groupJoinRequests)))},updateUnreadCount(e){this.unreadMessagesCount[e]=(this.unreadMessagesCount[e]||0)+1,this.followRelations=this.followRelations.map((s=>s.RoomID===e?{...s,UnreadCount:this.unreadMessagesCount[e]}:s))},loadUserRelations(){const e=localStorage.getItem("userRelations");if(e)try{const s=JSON.parse(e);this.followRelations=s.map((e=>(void 0===this.unreadMessagesCount[e.RoomID]&&(this.unreadMessagesCount[e.RoomID]=e.UnreadCount||0),{...e,UnreadCount:this.unreadMessagesCount[e.RoomID]})))}catch(s){console.error("Error parsing followRelations from localStorage:",s)}else console.log("No followRelations found in localStorage"),this.followRelations=[]},sendChatMessage(e,s){const o=JSON.parse(localStorage.getItem("user")),t=o.userID,i=new Date;let n={type:"chatMessage",payload:{senderUserId:t,receiverUserId:this.currentRelationUserId,content:e,roomId:s,timestamp:i.toISOString()}};console.log("Sending chat message with timestamp:",n),this.ws.send(JSON.stringify(n))},fetchMessages(e){let s={type:"fetchMessages",payload:{roomId:e}};console.log("Fetching messages for room:",e),this.ws.send(JSON.stringify(s))},handleCloseChat(e){void 0!==this.openChats[e]&&(this.openChats[e]=!1,this.messages=[])},followUser(e){const s=this.users.find((s=>s.userID===e))?.isPrivate;if(s){const s={type:"followRequest",payload:{targetUserId:e,requesterUserId:this.currentUserId}};this.ws.send(JSON.stringify(s)),this.pendingRequestsMap[e]="pending",localStorage.setItem("pendingRequests",JSON.stringify(this.pendingRequestsMap))}else console.log("Following user:",e),this.$axios.post("/api/following",{userId:e,action:"follow"}).then((()=>{this.followingMap[this.currentUserId]||(this.followingMap[this.currentUserId]=[]),this.followingMap[this.currentUserId].push(e),localStorage.setItem("followingMap",JSON.stringify(this.followingMap)),this.loadUserRelations(),this.fetchUsers()})).catch((e=>console.error("Error following user:",e)))},unfollowUser(e){console.log("Unfollowing user:",e),this.$axios.post("/api/following",{userId:e,action:"unfollow"}).then((()=>{const s=this.followingMap[this.currentUserId]?.indexOf(e);s>-1&&(this.followingMap[this.currentUserId].splice(s,1),localStorage.setItem("followingMap",JSON.stringify(this.followingMap))),this.fetchUsers()})).catch((e=>console.error("Error unfollowing user:",e)))},cancelFollowRequest(e){const s={type:"cancelFollowRequest",payload:{targetUserId:e,requesterUserId:this.currentUserId}};this.ws.send(JSON.stringify(s)),this.pendingRequestsMap[e]&&(delete this.pendingRequestsMap[e],this.pendingRequestsMap={...this.pendingRequestsMap},localStorage.setItem("pendingRequests",JSON.stringify(this.pendingRequestsMap))),this.fetchUsers()},fetchUsers(){this.$axios.get("/api/users").then((e=>{this.users=e.data.map((e=>({...e,isPrivate:"Private"===e.profilePrivacy,followStatus:"none"})))})).catch((e=>{console.error("Error fetching users:",e)}))},updateFollowStatus(e,s){this.users=this.users.map((o=>o.userID===e?{...o,followStatus:s}:o))},submitGroup(){console.log("Submitting group data:",this.groupName,this.groupDescription,this.selectedUserIds);const e={group:{name:this.groupName,description:this.groupDescription},invitedUserIds:this.selectedUserIds};this.$axios.post("/api/createGroup",e).then((e=>{console.log("Group created:",e.data),this.groups.push(e.data),this.groupName="",this.groupDescription="",this.selectedUserIds=[]})).catch((e=>{console.error("Error creating group:",e)}))},toggleNotificationCenter(){if(this.isNotificationCenterVisible=!this.isNotificationCenterVisible,this.isNotificationCenterVisible){const e=["eventInvite","groupInvite","followRequestCheck","groupJoinRequestCheck"];e.forEach((e=>{const s={type:e,payload:{userId:this.currentUserId}};console.log("Notifications payload for "+e+":",s),this.ws.send(JSON.stringify(s))}))}},handleResponse(e,s,o){let t;"event"===o?t={type:"eInviteResponse",payload:{responseId:e.responseId,userId:this.currentUserId,response:s}}:"group"===o?t={type:"gInviteResponse",payload:{groupId:e.groupId,userId:this.currentUserId,accept:s}}:"follow"===o?(t={type:s?"acceptFollowRequest":"declineFollowRequest",payload:{userId:this.currentUserId,followerUserId:e.followerUserId}},this.ws.send(JSON.stringify(t)),this.notifications=this.notifications.filter((s=>"followRequest"!==s.type||s.followerUserId!==e.followerUserId))):"groupJoinRequest"===o&&(t={type:s?"acceptGroupJoinRequest":"declineGroupJoinRequest",payload:{userId:this.currentUserId,requestId:e.requestId}}),console.log(`${o} response payload going to backend`,t),this.ws.send(JSON.stringify(t)),"groupJoinRequest"===o?this.notifications=this.notifications.filter((s=>s.requestId!==e.requestId)):"event"!==o&&"group"!==o||(this.notifications=this.notifications.filter((s=>"event"===o?s.responseId!==e.responseId:s.groupId!==e.groupId)))}}};const hi=(0,l.Z)(gi,[["render",pi],["__scopeId","data-v-1f2ff3cd"]]);var mi=hi;const fi=e=>((0,i.dD)("data-v-78cf67d8"),e=e(),(0,i.Cn)(),e),wi={class:"header-element-wrapper"},Ii={class:"header-element-wrapper"},vi={class:"navbar"},yi={class:"header-element-wrapper"},Ui={class:"main-container"},ki={class:"content-wrapper"},Ci={class:"group-detail-content"},_i={class:"user-list"},bi=fi((()=>(0,i._)("h2",null,"Group Members",-1))),Ri=["src"],Di={class:"left-sidebar"},Ni={class:"action-buttons-left-sidebar"},Si={key:0},qi={key:0,class:"invite-users-list"},Mi=["id","value"],Pi=["for"],Oi={class:"event-list"},Ei={key:0},Ji=fi((()=>(0,i._)("h3",null,"Events",-1))),Gi=fi((()=>(0,i._)("br",null,null,-1))),zi=["onClick"],Fi={key:0,class:"event-details"},Li={key:0},Ai=fi((()=>(0,i._)("p",null,"Going:",-1))),Wi={key:1},xi=fi((()=>(0,i._)("p",null,"Not Going:",-1))),$i={class:"event-creation-sidebar-header"},ji=fi((()=>(0,i._)("span",{class:"sidebar-back"},[(0,i._)("svg",{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:"512.000000pt",height:"512.000000pt",viewBox:"0 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet"},[(0,i._)("g",{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",fill:"#000000",stroke:"none"},[(0,i._)("path",{d:"M2058 4727 c-31 -13 -74 -38 -95 -55 -77 -62 -1882 -1878 -1907\n                -1920 -38 -61 -60 -154 -52 -225 14 -132 -40 -73 1014 -1129 795 -796 975\n                -971 1020 -994 78 -39 202 -46 285 -14 89 34 153 90 191 169 28 60 31 75 31\n                161 0 165 16 144 -562 729 -274 278 -534 536 -579 575 -45 40 -118 91 -167\n                116 l-86 45 1837 5 1837 5 57 23 c81 33 160 108 200 190 30 60 33 75 33 152\n                -1 70 -5 95 -27 142 -35 76 -99 143 -173 181 l-60 32 -1855 5 -1855 5 95 50\n                95 49 576 576 c665 664 634 624 634 795 0 89 -3 106 -28 156 -15 31 -50 78\n                -77 103 -72 68 -126 89 -235 93 -77 3 -98 0 -147 -20z"})])])],-1))),Vi=[ji],Ti=fi((()=>(0,i._)("h2",null,"Create New Event",-1))),Yi={class:"create-event-body"},Hi={class:"form-group"},Ki=fi((()=>(0,i._)("label",{for:"eventName"},"Event Title:",-1))),Bi={class:"form-group"},Zi=fi((()=>(0,i._)("label",{for:"eventDescription"},"Description:",-1))),Qi={class:"form-group"},Xi=fi((()=>(0,i._)("label",{for:"eventDateTime"},"Day/Time:",-1))),en=fi((()=>(0,i._)("label",null,"Invite Group Members:",-1))),sn={class:"user-invitation-list"},on=["id","value"],tn=["for"],nn=fi((()=>(0,i._)("button",{type:"submit"},"Create Event",-1))),rn={class:"notification-center-header"},an=fi((()=>(0,i._)("span",{class:"sidebar-back"},[(0,i._)("svg",{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:"512.000000pt",height:"512.000000pt",viewBox:"0 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet"},[(0,i._)("g",{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",fill:"#000000",stroke:"none"},[(0,i._)("path",{d:"M2058 4727 c-31 -13 -74 -38 -95 -55 -77 -62 -1882 -1878 -1907\n                -1920 -38 -61 -60 -154 -52 -225 14 -132 -40 -73 1014 -1129 795 -796 975\n                -971 1020 -994 78 -39 202 -46 285 -14 89 34 153 90 191 169 28 60 31 75 31\n                161 0 165 16 144 -562 729 -274 278 -534 536 -579 575 -45 40 -118 91 -167\n                116 l-86 45 1837 5 1837 5 57 23 c81 33 160 108 200 190 30 60 33 75 33 152\n                -1 70 -5 95 -27 142 -35 76 -99 143 -173 181 l-60 32 -1855 5 -1855 5 95 50\n                95 49 576 576 c665 664 634 624 634 795 0 89 -3 106 -28 156 -15 31 -50 78\n                -77 103 -72 68 -126 89 -235 93 -77 3 -98 0 -147 -20z"})])])],-1))),ln=[an],cn=fi((()=>(0,i._)("h2",null,"Notifications",-1))),un={class:"notification-list"},dn={key:0},pn={key:0,class:"notification-message"},gn={class:"event-invite-message"},hn={class:"response-buttons"},mn=["onClick"],fn=["onClick"],wn={key:1},In={class:"group-invite-message"},vn={class:"response-buttons"},yn=["onClick"],Un=["onClick"],kn={key:2},Cn={class:"follow-request-message"},_n={class:"response-buttons"},bn=["onClick"],Rn=["onClick"],Dn={key:3},Nn={class:"group-join-request-message"},Sn={class:"response-buttons"},qn=["onClick"],Mn=["onClick"];function Pn(e,s,o,n,r,a){const l=(0,i.up)("router-link"),c=(0,i.up)("ContentContainer"),u=(0,i.up)("GroupChatWindow");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("header",null,[(0,i._)("div",wi,[(0,i._)("h1",null,"Welcome to "+(0,m.zw)(r.groupName),1)]),(0,i._)("div",Ii,[(0,i._)("nav",vi,[(0,i.Wm)(l,{to:"/",class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("HOME")])),_:1}),(0,i.Wm)(l,{to:"/groups",class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("GROUPS")])),_:1}),(0,i.Wm)(l,{to:"/users",class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("USERS")])),_:1}),(0,i.Wm)(l,{to:`/profile/${a.currentUserId}`,class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("PROFILE")])),_:1},8,["to"])])]),(0,i._)("div",yi,[(0,i._)("button",{onClick:s[0]||(s[0]=(...e)=>a.handleLogout&&a.handleLogout(...e))},"Log Out")])]),(0,i._)("div",Ui,[(0,i._)("div",ki,[(0,i._)("div",Ci,[(0,i.Wm)(c,{currentUserId:a.currentUserId,groupID:r.groupId},null,8,["currentUserId","groupID"])]),(0,i._)("aside",_i,[bi,(0,i._)("ul",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.groupMembers,(e=>((0,i.wg)(),(0,i.iD)("li",{key:e.UserID},[(0,i._)("img",{src:e.profilePicture||r.defaultProfilePic,alt:"Profile Image",class:"profile-image"},null,8,Ri),(0,i.Uk)(" "+(0,m.zw)(e.firstName+" "+e.lastName),1)])))),128))]),(0,i.Wm)(u,{isVisible:r.showGroupChat,groupId:r.groupId,groupName:r.groupName,messages:r.messages.filter((e=>e.roomId===r.currentRoomId)),currentUserId:a.currentUserId,onClose:s[1]||(s[1]=e=>r.showGroupChat=!1),onSendMessage:a.sendChatMessage},null,8,["isVisible","groupId","groupName","messages","currentUserId","onSendMessage"]),a.isGroupMember?((0,i.wg)(),(0,i.iD)("button",{key:0,onClick:s[2]||(s[2]=e=>a.connectToGroupChat(r.groupId)),class:"join-groupchat-btn"},"Join Group Chat")):(0,i.kq)("",!0)]),(0,i._)("aside",Di,[(0,i._)("div",Ni,[(0,i._)("button",{onClick:s[3]||(s[3]=e=>a.toggleNotificationCenter())},"Notification Center"),a.isGroupMember?((0,i.wg)(),(0,i.iD)("div",Si,[(0,i._)("button",{onClick:s[4]||(s[4]=e=>r.isCreatEventVisible=!r.isCreatEventVisible)},"Create New Event"),(0,i._)("button",{onClick:s[5]||(s[5]=(...e)=>a.toggleInviteList&&a.toggleInviteList(...e))},"Invite Users")])):(0,i.kq)("",!0)]),r.showInviteList?((0,i.wg)(),(0,i.iD)("div",qi,[(0,i._)("ul",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.filteredUsers,(e=>((0,i.wg)(),(0,i.iD)("li",{key:e.userID},[(0,i.wy)((0,i._)("input",{type:"checkbox",id:`invite-${e.userID}`,value:e.userID,"onUpdate:modelValue":s[6]||(s[6]=e=>r.selectedUserIds=e)},null,8,Mi),[[t.e8,r.selectedUserIds]]),(0,i._)("label",{for:`invite-${e.userID}`},(0,m.zw)(e.firstName+" "+e.lastName),9,Pi)])))),128))]),(0,i._)("button",{onClick:s[7]||(s[7]=(...e)=>a.submitInvitations&&a.submitInvitations(...e)),class:"invite-button"},"Send Invites")])):(0,i.kq)("",!0),(0,i._)("div",Oi,[r.events&&r.events.length>0?((0,i.wg)(),(0,i.iD)("div",Ei,[Ji,Gi,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.events,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.EventID,onClick:s=>a.toggleEvent(e.EventID),class:(0,m.C_)({event:!0,expanded:r.expandedEventId===e.EventID})},[(0,i._)("div",null,[(0,i._)("h3",null,(0,m.zw)(e.Title),1),(0,i._)("p",null,(0,m.zw)(new Date(e.EventDateTime).toLocaleString()),1)]),r.expandedEventId===e.EventID?((0,i.wg)(),(0,i.iD)("div",Fi,[(0,i._)("p",null,"Created by: "+(0,m.zw)(e.FirstName)+" "+(0,m.zw)(e.LastName),1),(0,i._)("p",null,(0,m.zw)(e.Description),1),e.Going.length>0?((0,i.wg)(),(0,i.iD)("div",Li,[Ai,(0,i._)("ul",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.Going,(e=>((0,i.wg)(),(0,i.iD)("li",{key:e},(0,m.zw)(e),1)))),128))])])):(0,i.kq)("",!0),e.NotGoing.length>0?((0,i.wg)(),(0,i.iD)("div",Wi,[xi,(0,i._)("ul",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.NotGoing,(e=>((0,i.wg)(),(0,i.iD)("li",{key:e},(0,m.zw)(e),1)))),128))])])):(0,i.kq)("",!0)])):(0,i.kq)("",!0)],10,zi)))),128))])):(0,i.kq)("",!0)])]),(0,i._)("aside",{class:(0,m.C_)(["event-creation-form",{"is-visible":r.isCreatEventVisible}])},[(0,i._)("div",$i,[(0,i._)("button",{onClick:s[8]||(s[8]=e=>r.isCreatEventVisible=!1)},Vi),Ti]),(0,i._)("div",Yi,[(0,i._)("form",{onSubmit:s[13]||(s[13]=(0,t.iM)(((...e)=>a.submitEvent&&a.submitEvent(...e)),["prevent"]))},[(0,i._)("div",Hi,[Ki,(0,i.wy)((0,i._)("input",{type:"text",id:"eventName","onUpdate:modelValue":s[9]||(s[9]=e=>r.eventName=e),required:""},null,512),[[t.nr,r.eventName]])]),(0,i._)("div",Bi,[Zi,(0,i.wy)((0,i._)("textarea",{id:"eventDescription","onUpdate:modelValue":s[10]||(s[10]=e=>r.eventDescription=e),rows:"5",required:""},null,512),[[t.nr,r.eventDescription]])]),(0,i._)("div",Qi,[Xi,(0,i.wy)((0,i._)("input",{type:"datetime-local",id:"eventDateTime","onUpdate:modelValue":s[11]||(s[11]=e=>r.eventDateTime=e),required:""},null,512),[[t.nr,r.eventDateTime]])]),en,(0,i._)("ul",sn,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.groupMembers,(e=>((0,i.wg)(),(0,i.iD)("li",{key:e.userID},[(0,i.wy)((0,i._)("input",{type:"checkbox",id:`invite-${e.userID}`,value:e.userID,"onUpdate:modelValue":s[12]||(s[12]=e=>r.selectedUserIds=e)},null,8,on),[[t.e8,r.selectedUserIds]]),(0,i._)("label",{for:`invite-${e.userID}`},(0,m.zw)(e.firstName+" "+e.lastName),9,tn)])))),128))]),nn],32)])],2),(0,i._)("aside",{class:(0,m.C_)(["notification-center",{"is-visible":r.isNotificationCenterVisible}])},[(0,i._)("div",rn,[(0,i._)("button",{onClick:s[14]||(s[14]=e=>{r.isNotificationCenterVisible=!1,r.notifications=[]})},ln),cn]),(0,i._)("div",un,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.notifications,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.id,class:"notification"},["eventInvite"===e.type?((0,i.wg)(),(0,i.iD)("div",dn,[r.notificationMessage?((0,i.wg)(),(0,i.iD)("div",pn,(0,m.zw)(r.notificationMessage),1)):(0,i.kq)("",!0),(0,i._)("p",gn,[(0,i.Uk)(" You have been invited to "),(0,i._)("strong",null,(0,m.zw)(e.groupName),1),(0,i.Uk)(" event "),(0,i._)("strong",null,'"'+(0,m.zw)(e.title)+'"',1),(0,i.Uk)(" by "),(0,i._)("strong",null,(0,m.zw)(e.creatorFirstName)+" "+(0,m.zw)(e.creatorLastName),1)]),(0,i._)("div",hn,[(0,i._)("button",{class:"going",onClick:s=>a.handleResponse(e,"Going","event")},"Going",8,mn),(0,i._)("button",{class:"notGoing",onClick:s=>a.handleResponse(e,"Not Going","event")},"Not Going",8,fn)])])):"groupInvite"===e.type?((0,i.wg)(),(0,i.iD)("div",wn,[(0,i._)("p",In,[(0,i.Uk)(" You have been invited to join the group "),(0,i._)("strong",null,'"'+(0,m.zw)(e.groupName)+'"',1),(0,i.Uk)(" by "),(0,i._)("strong",null,(0,m.zw)(e.creatorName),1),(0,i.Uk)(". ")]),(0,i._)("div",vn,[(0,i._)("button",{class:"accept",onClick:s=>a.handleResponse(e,!0,"group")},"Accept",8,yn),(0,i._)("button",{class:"decline",onClick:s=>a.handleResponse(e,!1,"group")},"Decline",8,Un)])])):"followRequest"===e.type?((0,i.wg)(),(0,i.iD)("div",kn,[(0,i._)("p",Cn,[(0,i._)("strong",null,(0,m.zw)(e.firstName)+" "+(0,m.zw)(e.lastName),1),(0,i.Uk)(" wants to follow you. ")]),(0,i._)("div",_n,[(0,i._)("button",{class:"accept",onClick:s=>a.handleResponse(e,!0,"follow")},"Accept",8,bn),(0,i._)("button",{class:"decline",onClick:s=>a.handleResponse(e,!1,"follow")},"Decline",8,Rn)])])):(0,i.kq)("",!0),"groupJoinRequest"===e.type?((0,i.wg)(),(0,i.iD)("div",Dn,[(0,i._)("p",Nn,[(0,i._)("strong",null,(0,m.zw)(e.FirstName)+" "+(0,m.zw)(e.LastName),1),(0,i.Uk)(" wants to join your group "),(0,i._)("strong",null,'"'+(0,m.zw)(e.groupName)+'"',1),(0,i.Uk)(". ")]),(0,i._)("div",Sn,[(0,i._)("button",{class:"accept",onClick:s=>a.handleResponse(e,!0,"groupJoinRequest")},"Accept",8,qn),(0,i._)("button",{class:"decline",onClick:s=>a.handleResponse(e,!1,"groupJoinRequest")},"Decline",8,Mn)])])):(0,i.kq)("",!0)])))),128))])],2)])])],64)}const On=e=>((0,i.dD)("data-v-2f366b68"),e=e(),(0,i.Cn)(),e),En={key:0,class:"group-chat-window"},Jn={class:"header"},Gn={class:"messages",ref:"messagesContainer"},zn={class:"message-content-container"},Fn={class:"message-sender"},Ln={class:"message-content"},An={class:"message-timestamp"},Wn={class:"input-area"},xn={key:0,class:"emoji-picker"},$n=["onClick"],jn={class:"input-area-button-container"},Vn=On((()=>(0,i._)("span",{class:"emoji"},"ðŸ˜Š",-1))),Tn=[Vn];function Yn(e,s,o,n,r,a){return(0,i.wg)(),(0,i.j4)(t.uT,{name:"slide"},{default:(0,i.w5)((()=>[o.isVisible?((0,i.wg)(),(0,i.iD)("div",En,[(0,i._)("div",Jn,[(0,i._)("h3",null,(0,m.zw)(o.groupName)+" - Group Chat",1),(0,i._)("button",{onClick:s[0]||(s[0]=(...e)=>a.closeChat&&a.closeChat(...e))},"x")]),(0,i._)("div",Gn,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.messages,((e,s)=>((0,i.wg)(),(0,i.iD)("div",{key:s,class:(0,m.C_)({"message-sent":e.senderUserId===o.currentUserId,"message-received":e.senderUserId!==o.currentUserId})},[(0,i._)("div",zn,[(0,i._)("div",Fn,(0,m.zw)(e.senderFirstName)+" "+(0,m.zw)(e.senderLastName),1),(0,i._)("div",Ln,(0,m.zw)(e.content),1)]),(0,i._)("div",An,(0,m.zw)(new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),1)],2)))),128))],512),(0,i._)("div",Wn,[r.showEmojiPicker?((0,i.wg)(),(0,i.iD)("div",xn,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.emojis,(e=>((0,i.wg)(),(0,i.iD)("button",{key:e,onClick:s=>a.addEmoji(e)},(0,m.zw)(e),9,$n)))),128))])):(0,i.kq)("",!0),(0,i.wy)((0,i._)("input",{type:"text",placeholder:"Type a message...","onUpdate:modelValue":s[1]||(s[1]=e=>r.newMessage=e),onKeyup:s[2]||(s[2]=(0,t.D2)(((...e)=>a.sendMessage&&a.sendMessage(...e)),["enter"]))},null,544),[[t.nr,r.newMessage]]),(0,i._)("div",jn,[(0,i._)("button",{onClick:s[3]||(s[3]=(...e)=>a.toggleEmojiPicker&&a.toggleEmojiPicker(...e))},Tn),(0,i._)("button",{onClick:s[4]||(s[4]=(...e)=>a.sendMessage&&a.sendMessage(...e))},"Send")])])])):(0,i.kq)("",!0)])),_:1})}var Hn={name:"GroupChatWindow",props:{isVisible:{type:Boolean,required:!0},groupId:{type:String,required:!0},groupName:{type:String,required:!0},messages:Array,currentUserId:[String,Number]},components:{},data(){return{newMessage:"",showEmojiPicker:!1,emojis:["ðŸ˜€","ðŸ˜","ðŸ˜‚","ðŸ¤£","ðŸ˜ƒ","ðŸ˜„","ðŸ˜…","ðŸ˜†","ðŸ˜‰","ðŸ˜Š","ðŸ˜‹","ðŸ˜Ž","ðŸ˜","ðŸ˜˜","ðŸ¥°","ðŸ˜—","ðŸ˜™","ðŸ˜š","ðŸ™‚","ðŸ¤—","ðŸ˜‡","ðŸ¤©","ðŸ¤”","ðŸ¤“","ðŸ˜","ðŸ˜Œ","ðŸ˜œ","ðŸ¤ª"]}},watch:{messages(){this.scrollToBottom()}},mounted(){this.scrollToBottom()},methods:{scrollToBottom(){this.$nextTick((()=>{const e=this.$refs.messagesContainer;e&&(e.scrollTop=e.scrollHeight)}))},sendMessage(){if(!this.newMessage.trim())return;const e={content:this.newMessage,groupId:this.groupId};this.$emit("sendMessage",e),this.newMessage=""},toggleEmojiPicker(){this.showEmojiPicker=!this.showEmojiPicker},addEmoji(e){this.newMessage+=e,this.toggleEmojiPicker()},closeChat(){this.$emit("close")}}};const Kn=(0,l.Z)(Hn,[["render",Yn],["__scopeId","data-v-2f366b68"]]);var Bn=Kn,Zn={name:"GroupDetail",components:{ContentContainer:Vs,GroupChatWindow:Bn},data(){return{defaultProfilePic:xs,group:null,groupId:this.$route.params.groupId,ws:null,serverUrl:"ws://localhost:8091/ws",messages:[],unreadMessagesCount:{},newMessage:"",currentRoomId:null,openChats:{},followRelations:[],isCreatEventVisible:!1,availableUsers:[],events:[],expandedEventId:null,eventName:"",eventDescription:"",eventDateTime:"",selectedUserIds:[],groupName:"",groupDescription:"",groupMembers:[],showGroupChat:!1,invitedUserIds:[],filteredUsers:[],showInviteList:!1,notifications:[],notificationMessage:"",isNotificationCenterVisible:!1}},watch:{currentRoomId(e,s){console.log(`currenRoomId changed from ${s} to ${e}`)},"group.name"(e,s){console.log(`Group name changed from ${s} to ${e}`)},messages:{handler(e){console.log("Messages array changed.",e)},deep:!0},showGroupChat(e){console.log(`showGroupChat changed to ${e}`)},events:{handler(e,s){console.log("Events changed",e,s)},deep:!0}},mounted(){this.loadUserRelations(),this.connectToWebsocket(),this.fetchGroupDetail(),this.fetchGroupMembers(),this.fetchEvents();const e=JSON.parse(localStorage.getItem("joinGroupChatData"));e&&(console.log("Group chatroom ID:",e),localStorage.removeItem("joinGroupChatData"))},computed:{...(0,p.rn)(["isLoggedIn","currentUser"]),currentUserId(){const e=JSON.parse(localStorage.getItem("user"));return e?e.userID:null},filteredOpenChats(){return Array.isArray(this.followRelations)?this.followRelations.filter((e=>this.openChats[e.RoomID])):[]},isGroupMember(){return this.groupMembers.includes(this.currentUserId)}},methods:{...(0,p.nv)(["logOut"]),handleLogout(){this.$axios.post("/api/logout").then((()=>{this.logOut(),this.$cookies.remove("session_id"),localStorage.clear(),this.$router.push("/welcome")})).catch((e=>{console.error("Logout failed:",e)}))},loadUserRelations(){const e=localStorage.getItem("userRelations");if(e)try{const s=JSON.parse(e);this.followRelations=s.map((e=>(void 0===this.unreadMessagesCount[e.RoomID]&&(this.unreadMessagesCount[e.RoomID]=e.UnreadCount||0),{...e,UnreadCount:this.unreadMessagesCount[e.RoomID]})))}catch(s){console.error("Error parsing followRelations from localStorage:",s)}else console.log("No followRelations found in localStorage"),this.followRelations=[]},connectToWebsocket(){this.ws&&this.ws.readyState===WebSocket.OPEN?console.log("WebSocket already open."):(console.log("Attempting to connect to WebSocket"),this.ws=new WebSocket(this.serverUrl),this.ws.addEventListener("open",this.onWebsocketOpen),this.ws.addEventListener("message",(e=>{this.handleNewMessage(e)})),this.ws.addEventListener("error",this.onWebsocketError),this.ws.addEventListener("close",this.onWebsocketClose))},onWebsocketOpen(){console.log("Connected to WS!")},onWebsocketError(e){console.error("WebSocket Error: ",e)},onWebsocketClose(){console.log("WebSocket connection closed")},handleNewMessage(e){console.log("Received WebSocket message:",e.data);const s=e.data.split("\n").filter((e=>e.trim()));let o;if(s.forEach((e=>{try{switch(o=JSON.parse(e),o.type){case"joinGroupChatResponse":this.handleJoinGroupChatResponse(o.payload);break;case"chatMessage":o.payload.roomId===this.currentRoomId?this.messages.push(o.payload):this.openChats[o.payload.roomId]||this.updateUnreadCount(o.payload.roomId);break;case"fetchMessagesResponse":if(console.log("Fetched messages:",o.payload),o.payload.roomId===this.currentRoomId&&o.payload.messages&&o.payload.messages.length>0){const e=o.payload.messages.reverse();this.messages=[...e,...this.messages]}break;case"eventInviteResponse":console.log("Event invite response payload:",o.payload),Array.isArray(o.payload)?o.payload.forEach((e=>{const s=this.notifications.findIndex((s=>"eventInvite"===s.type&&s.responseId===e.responseId));-1===s?this.notifications.push({type:"eventInvite",...e}):this.notifications[s]={...this.notifications[s],...e}})):o.payload.message&&(this.notificationMessage=o.payload.message);break;case"groupInviteResponse":console.log("Group invite response payload:",o.payload),Array.isArray(o.payload)?o.payload.forEach((e=>{const s={type:"groupInvite",groupId:e.GroupID,groupName:e.Name,groupDescription:e.Description,creatorUserId:e.CreatorUserID,creatorName:e.CreatorName},o=this.notifications.findIndex((s=>"groupInvite"===s.type&&s.groupId===e.GroupID));-1===o?this.notifications.push(s):this.notifications[o]={...this.notifications[o],...s}})):o.payload.message&&(this.notificationMessage=o.payload.message);break;case"followRequestResponse":console.log("Follow request payload:",o.payload),Array.isArray(o.payload)&&o.payload.forEach((e=>{const s={type:"followRequest",followerUserId:e.followerUserId,firstName:e.firstName,lastName:e.lastName},o=this.notifications.findIndex((s=>"followRequest"===s.type&&s.followerUserId===e.followerUserId));-1===o?this.notifications.push(s):this.notifications[o]={...this.notifications[o],...s}}));break;case"groupJoinRequestResponse":console.log("Group join request payload:",o.payload),Array.isArray(o.payload)&&o.payload.forEach((e=>{const s={type:"groupJoinRequest",requestId:e.requestId,groupId:e.groupId,groupName:e.groupName,requesterUserId:e.userId,LastName:e.lastName,FirstName:e.firstName};this.notifications.push(s)}));break}}catch(s){console.error("Error parsing individual message:",s)}})),o.userRelations){console.log("User relations received:",o.userRelations);const e=Object.values(o.userRelations);localStorage.setItem("userRelations",JSON.stringify(e))}o.followingMap&&(console.log("Following map received:",o.followingMap),localStorage.setItem("followingMap",JSON.stringify(o.followingMap))),o.followersMap&&(console.log("Followers map received:",o.followersMap),localStorage.setItem("followersMap",JSON.stringify(o.followersMap))),o.pendingRequests&&(console.log("Requests map received:",o.pendingRequests),localStorage.setItem("pendingRequests",JSON.stringify(o.pendingRequests))),o.userGroups&&(console.log("User groups received:",o.userGroups),localStorage.setItem("userGroups",JSON.stringify(o.userGroups))),o.groupJoinRequests&&(console.log("Group join requests received:",o.groupJoinRequests),localStorage.setItem("groupJoinRequests",JSON.stringify(o.groupJoinRequests)))},fetchGroupDetail(){const e=this.$route.params.groupId;this.$axios.post("/api/group/details",{groupId:e},{withCredentials:!0}).then((e=>{console.log(e),this.group=e.data;const s=e.data;this.groupName=s.name,this.groupDescription=s.description})).catch((e=>{console.error("Failed to fetch group details:",e)}))},sendChatMessage(e){const s=JSON.parse(localStorage.getItem("user")),o=s.userID,t=new Date,i=e.groupId?parseInt(e.groupId,10):void 0,n=isNaN(i)?void 0:i;let r={type:"chatMessage",payload:{senderUserId:o,content:e.content,timestamp:t.toISOString(),groupId:n,roomId:this.currentRoomId?this.currentRoomId:void 0}};console.log("Sending chat message:",JSON.stringify(r)),this.ws.send(JSON.stringify(r))},toggleInviteList(){this.showInviteList=!this.showInviteList,this.showInviteList&&this.prepareInviteList()},prepareInviteList(){Promise.all([this.fetchUsers(),this.fetchGroupMembers(),this.fetchInvitedUsers()]).then((()=>{this.filterOutGroupMembersAndInvitedUsers()})).catch((e=>console.error("Error preparing invite list:",e)))},fetchMessages(e){const s=this.groupId?parseInt(this.groupId,10):null;let o={type:"fetchMessages",payload:{roomId:e,...Number.isInteger(s)&&{groupId:s}}};console.log("Fetching messages for room:",e),console.log("Fetching messages with payload:",o),this.ws.send(JSON.stringify(o))},handleCloseChat(e){void 0!==this.openChats[e]&&(this.openChats[e]=!1)},fetchUsers(){return this.$axios.get("/api/users").then((e=>{this.availableUsers=e.data})).catch((e=>{throw console.error("Error fetching users:",e),e}))},fetchInvitedUsers(){const e={groupId:parseInt(this.groupId,10)};return this.$axios.post("/api/invitedUsers",e).then((e=>{this.invitedUserIds=e.data.map((e=>e.userID))})).catch((e=>{throw console.error("Error fetching invited users:",e),e}))},filterOutGroupMembersAndInvitedUsers(){const e=new Set([...this.groupMembers.map((e=>e.userID)),...this.invitedUserIds]);this.filteredUsers=this.availableUsers.filter((s=>!e.has(s.userID)))},submitInvitations(){const e={groupId:parseInt(this.groupId,10),invitedUserIds:this.selectedUserIds};console.log(typeof e.invitedUserIds,e.invitedUserIds),console.log(typeof e.groupId,e.groupId),this.$axios.post("/api/inviteUsers",e).then((e=>{console.log("Invitations sent successfully:",e.data),alert("Invitations sent successfully."),this.selectedUserIds=[],location.reload()})).catch((e=>{console.error("Error sending invitations:",e)}))},submitGroup(){console.log("Submitting group data:",this.groupName,this.groupDescription,this.selectedUserIds);const e={group:{name:this.groupName,description:this.groupDescription},invitedUserIds:this.selectedUserIds};this.$axios.post("/api/createGroup",e).then((e=>{console.log("Group created:",e.data),this.groups.push(e.data),this.groupName="",this.groupDescription="",this.selectedUserIds=[]})).catch((e=>{console.error("Error creating group:",e)}))},fetchGroupMembers(){this.$axios.get(`/api/groupMembers?groupID=${this.groupId}`).then((e=>{e.data?(console.log("Fetched group members",e.data),this.groupMembers=e.data):(console.log("No memebers found or the response is null"),this.groupMembers=[])})).catch((e=>{console.error("Error fetching group members:",e)}))},connectToGroupChat(e){console.log(`Attempting to join group chat with ID: ${e}`);const s={type:"joinGroupChat",payload:{groupId:e}};this.showGroupChat=!0,this.ws.send(JSON.stringify(s))},handleJoinGroupChatResponse(e){console.log("Handling data: ",e),this.currentRoomId=e.roomId,this.fetchMessages(this.currentRoomId)},submitEvent(){const e={title:this.eventName,description:this.eventDescription,dateTime:this.eventDateTime+":00Z",invitedMembers:this.selectedUserIds,eventCreator:this.currentUserId,groupId:parseInt(this.groupId,10)};this.createEvent(e)},createEvent(e){console.log("Creating event:",e),this.$axios.post("/api/createEvent",e).then((e=>{console.log("Created event:",e.data),this.eventName="",this.eventDescription="",this.eventDateTime="",this.selectedUserIds=[],this.isCreatEventVisible=!1})).catch((e=>{console.error("Error creating event:",e)}))},fetchEvents(){const e=this.groupId;console.log(`Fetching events for GroupID: ${e}`),this.$axios.get(`api/events?groupID=${e}`).then((e=>{e.data?(console.log("These are the fetched events:",e.data),this.events=e.data):(console.log("No events found or the response is null"),this.events=[])})).catch((e=>{console.error("There was an error fetching the events:",e)}))},toggleEvent(e){this.expandedEventId=this.expandedEventId===e?null:e},toggleNotificationCenter(){if(this.isNotificationCenterVisible=!this.isNotificationCenterVisible,this.isNotificationCenterVisible){const e=["eventInvite","groupInvite","followRequestCheck","groupJoinRequestCheck"];e.forEach((e=>{const s={type:e,payload:{userId:this.currentUserId}};console.log("Notifications payload for "+e+":",s),this.ws.send(JSON.stringify(s))}))}},handleResponse(e,s,o){let t;"event"===o?t={type:"eInviteResponse",payload:{responseId:e.responseId,userId:this.currentUserId,response:s}}:"group"===o?t={type:"gInviteResponse",payload:{groupId:e.groupId,userId:this.currentUserId,accept:s}}:"follow"===o?(t={type:s?"acceptFollowRequest":"declineFollowRequest",payload:{userId:this.currentUserId,followerUserId:e.followerUserId}},this.ws.send(JSON.stringify(t)),this.notifications=this.notifications.filter((s=>"followRequest"!==s.type||s.followerUserId!==e.followerUserId))):"groupJoinRequest"===o&&(t={type:s?"acceptGroupJoinRequest":"declineGroupJoinRequest",payload:{userId:this.currentUserId,requestId:e.requestId}}),console.log(`${o} response payload going to backend`,t),this.ws.send(JSON.stringify(t)),"groupJoinRequest"===o?this.notifications=this.notifications.filter((s=>s.requestId!==e.requestId)):"event"!==o&&"group"!==o||(this.notifications=this.notifications.filter((s=>"event"===o?s.responseId!==e.responseId:s.groupId!==e.groupId)))}}};const Qn=(0,l.Z)(Zn,[["render",Pn],["__scopeId","data-v-78cf67d8"]]);var Xn=Qn;const er=e=>((0,i.dD)("data-v-171fc8f8"),e=e(),(0,i.Cn)(),e),sr=er((()=>(0,i._)("div",{class:"header-element-wrapper"},null,-1))),or={class:"header-element-wrapper"},tr={class:"navbar"},ir={class:"header-element-wrapper"},nr={class:"main-container"},rr={class:"content-wrapper"},ar={class:"content-body"},lr={class:"chat-windows-container"},cr={class:"user-list"},ur=er((()=>(0,i._)("h2",null,"Contacts",-1))),dr=["onClick"],pr=["src"],gr={key:0,class:"unread-indicator"},hr={class:"left-sidebar"},mr={class:"notification-center-header"},fr=er((()=>(0,i._)("span",{class:"sidebar-back"},[(0,i._)("svg",{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:"512.000000pt",height:"512.000000pt",viewBox:"0 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet"},[(0,i._)("g",{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",fill:"#000000",stroke:"none"},[(0,i._)("path",{d:"M2058 4727 c-31 -13 -74 -38 -95 -55 -77 -62 -1882 -1878 -1907\n                -1920 -38 -61 -60 -154 -52 -225 14 -132 -40 -73 1014 -1129 795 -796 975\n                -971 1020 -994 78 -39 202 -46 285 -14 89 34 153 90 191 169 28 60 31 75 31\n                161 0 165 16 144 -562 729 -274 278 -534 536 -579 575 -45 40 -118 91 -167\n                116 l-86 45 1837 5 1837 5 57 23 c81 33 160 108 200 190 30 60 33 75 33 152\n                -1 70 -5 95 -27 142 -35 76 -99 143 -173 181 l-60 32 -1855 5 -1855 5 95 50\n                95 49 576 576 c665 664 634 624 634 795 0 89 -3 106 -28 156 -15 31 -50 78\n                -77 103 -72 68 -126 89 -235 93 -77 3 -98 0 -147 -20z"})])])],-1))),wr=[fr],Ir=er((()=>(0,i._)("h2",null,"Notifications",-1))),vr={class:"notification-list"},yr={key:0},Ur={key:0,class:"notification-message"},kr={class:"event-invite-message"},Cr={class:"response-buttons"},_r=["onClick"],br=["onClick"],Rr={key:1},Dr={class:"group-invite-message"},Nr={class:"response-buttons"},Sr=["onClick"],qr=["onClick"],Mr={key:2},Pr={class:"follow-request-message"},Or={class:"response-buttons"},Er=["onClick"],Jr=["onClick"],Gr={key:3},zr={class:"group-join-request-message"},Fr={class:"response-buttons"},Lr=["onClick"],Ar=["onClick"],Wr={class:"notification-center-header"},xr=er((()=>(0,i._)("span",{class:"sidebar-back"},[(0,i._)("svg",{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:"512.000000pt",height:"512.000000pt",viewBox:"0 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet"},[(0,i._)("g",{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",fill:"#000000",stroke:"none"},[(0,i._)("path",{d:"M2058 4727 c-31 -13 -74 -38 -95 -55 -77 -62 -1882 -1878 -1907\n                  -1920 -38 -61 -60 -154 -52 -225 14 -132 -40 -73 1014 -1129 795 -796 975\n                  -971 1020 -994 78 -39 202 -46 285 -14 89 34 153 90 191 169 28 60 31 75 31\n                  161 0 165 16 144 -562 729 -274 278 -534 536 -579 575 -45 40 -118 91 -167\n                  116 l-86 45 1837 5 1837 5 57 23 c81 33 160 108 200 190 30 60 33 75 33 152\n                  -1 70 -5 95 -27 142 -35 76 -99 143 -173 181 l-60 32 -1855 5 -1855 5 95 50\n                  95 49 576 576 c665 664 634 624 634 795 0 89 -3 106 -28 156 -15 31 -50 78\n                  -77 103 -72 68 -126 89 -235 93 -77 3 -98 0 -147 -20z"})])])],-1))),$r=[xr],jr=er((()=>(0,i._)("h2",null,"Notifications",-1))),Vr=er((()=>(0,i._)("h2",null,"User Profile",-1))),Tr=["src"],Yr={key:1},Hr={key:2};function Kr(e,s,o,n,r,a){const l=(0,i.up)("router-link"),c=(0,i.up)("ChatWindow"),u=(0,i.up)("ContentContainer");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("header",null,[sr,(0,i._)("div",or,[(0,i._)("nav",tr,[(0,i.Wm)(l,{to:"/",class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("HOME")])),_:1}),(0,i.Wm)(l,{to:"/groups",class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("GROUPS")])),_:1}),(0,i.Wm)(l,{to:"/users",class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("USERS")])),_:1}),(0,i.Wm)(l,{to:`/profile/${a.currentUserId}`,class:"nav-item"},{default:(0,i.w5)((()=>[(0,i.Uk)("PROFILE")])),_:1},8,["to"])])]),(0,i._)("div",ir,[(0,i._)("button",{onClick:s[0]||(s[0]=(...e)=>a.handleLogout&&a.handleLogout(...e))},"Log Out")])]),(0,i._)("div",nr,[(0,i._)("div",rr,[(0,i._)("section",ar,[(0,i._)("div",lr,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.filteredOpenChats,(e=>((0,i.wg)(),(0,i.j4)(c,{key:e.RoomID,currentRoomId:e.RoomID,messages:r.messages.filter((s=>s.roomId===e.RoomID)),currentUserId:a.currentUserId,sendMessageFunction:a.sendChatMessage,onCloseChat:a.handleCloseChat,class:"chat-window"},null,8,["currentRoomId","messages","currentUserId","sendMessageFunction","onCloseChat"])))),128))]),(0,i.Wm)(u,{currentUserId:a.currentUserId},null,8,["currentUserId"])]),(0,i._)("aside",cr,[ur,(0,i._)("ul",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.followRelations,(e=>((0,i.wg)(),(0,i.iD)("li",{key:e.UserID,onClick:s=>a.handleUserClick(e)},[(0,i._)("img",{src:e.profilePicture||r.defaultProfilePic,alt:"Profile Image",class:"profile-image"},null,8,pr),(0,i.Uk)(" "+(0,m.zw)(e.FirstName+" "+e.LastName)+" ",1),e.UnreadCount?((0,i.wg)(),(0,i.iD)("span",gr,(0,m.zw)(e.UnreadCount),1)):(0,i.kq)("",!0)],8,dr)))),128))])]),(0,i._)("aside",hr,[a.isAllowedToSeeDetails?((0,i.wg)(),(0,i.iD)("button",{key:0,onClick:s[1]||(s[1]=e=>r.isUserDataVisible=!r.isUserDataVisible)},"Profile Details")):(0,i.kq)("",!0),(0,i._)("button",{onClick:s[2]||(s[2]=e=>a.toggleNotificationCenter())},"Notification Center")]),(0,i._)("aside",{class:(0,m.C_)(["notification-center",{"is-visible":r.isNotificationCenterVisible}])},[(0,i._)("div",mr,[(0,i._)("button",{onClick:s[3]||(s[3]=e=>r.isNotificationCenterVisible=!1)},wr),Ir]),(0,i._)("div",vr,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.notifications,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.id,class:"notification"},["eventInvite"===e.type?((0,i.wg)(),(0,i.iD)("div",yr,[r.notificationMessage?((0,i.wg)(),(0,i.iD)("div",Ur,(0,m.zw)(r.notificationMessage),1)):(0,i.kq)("",!0),(0,i._)("p",kr,[(0,i.Uk)(" You have been invited to "),(0,i._)("strong",null,(0,m.zw)(e.groupName),1),(0,i.Uk)(" event "),(0,i._)("strong",null,'"'+(0,m.zw)(e.title)+'"',1),(0,i.Uk)(" by "),(0,i._)("strong",null,(0,m.zw)(e.creatorFirstName)+" "+(0,m.zw)(e.creatorLastName),1)]),(0,i._)("div",Cr,[(0,i._)("button",{class:"going",onClick:s=>a.handleResponse(e,"Going","event")},"Going",8,_r),(0,i._)("button",{class:"notGoing",onClick:s=>a.handleResponse(e,"Not Going","event")},"Not Going",8,br)])])):"groupInvite"===e.type?((0,i.wg)(),(0,i.iD)("div",Rr,[(0,i._)("p",Dr,[(0,i.Uk)(" You have been invited to join the group "),(0,i._)("strong",null,'"'+(0,m.zw)(e.groupName)+'"',1),(0,i.Uk)(" by "),(0,i._)("strong",null,(0,m.zw)(e.creatorName),1),(0,i.Uk)(". ")]),(0,i._)("div",Nr,[(0,i._)("button",{class:"accept",onClick:s=>a.handleResponse(e,!0,"group")},"Accept",8,Sr),(0,i._)("button",{class:"decline",onClick:s=>a.handleResponse(e,!1,"group")},"Decline",8,qr)])])):"followRequest"===e.type?((0,i.wg)(),(0,i.iD)("div",Mr,[(0,i._)("p",Pr,[(0,i._)("strong",null,(0,m.zw)(e.firstName)+" "+(0,m.zw)(e.lastName),1),(0,i.Uk)(" wants to follow you. ")]),(0,i._)("div",Or,[(0,i._)("button",{class:"accept",onClick:s=>a.handleResponse(e,!0,"follow")},"Accept",8,Er),(0,i._)("button",{class:"decline",onClick:s=>a.handleResponse(e,!1,"follow")},"Decline",8,Jr)])])):(0,i.kq)("",!0),"groupJoinRequest"===e.type?((0,i.wg)(),(0,i.iD)("div",Gr,[(0,i._)("p",zr,[(0,i._)("strong",null,(0,m.zw)(e.FirstName)+" "+(0,m.zw)(e.LastName),1),(0,i.Uk)(" wants to join your group "),(0,i._)("strong",null,'"'+(0,m.zw)(e.groupName)+'"',1),(0,i.Uk)(". ")]),(0,i._)("div",Fr,[(0,i._)("button",{class:"accept",onClick:s=>a.handleResponse(e,!0,"groupJoinRequest")},"Accept",8,Lr),(0,i._)("button",{class:"decline",onClick:s=>a.handleResponse(e,!1,"groupJoinRequest")},"Decline",8,Ar)])])):(0,i.kq)("",!0)])))),128))])],2),(0,i.wy)((0,i._)("aside",{class:(0,m.C_)(["profile-container",{"is-visible":r.isUserDataVisible}])},[(0,i._)("div",Wr,[(0,i._)("button",{onClick:s[4]||(s[4]=e=>{r.isUserDataVisible=!1,r.notifications=[]})},$r),jr]),Vr,(0,i._)("img",{src:r.userData.profilePicture||r.defaultProfilePic,alt:"Profile Picture",class:"profile-details-image"},null,8,Tr),(0,i._)("p",null,"Nickname: "+(0,m.zw)(r.userData.nickname),1),(0,i._)("p",null,"Name: "+(0,m.zw)(r.userData.firstName)+" "+(0,m.zw)(r.userData.lastName),1),(0,i._)("p",null,"Email: "+(0,m.zw)(r.userData.email),1),(0,i._)("p",null,"Date of Birth: "+(0,m.zw)(a.formatDOB(r.userData.dateOfBirth)),1),(0,i._)("p",null,"Gender: "+(0,m.zw)(r.userData.gender),1),(0,i._)("p",null,"About Me: "+(0,m.zw)(r.userData.aboutMe),1),(0,i._)("p",null,"Profile Privacy: "+(0,m.zw)(r.userData.profilePrivacy),1),(0,i._)("p",null,"Account Created: "+(0,m.zw)(a.formatTimestamp(r.userData.createdAt)),1),a.currentUserId===r.userData.userID?((0,i.wg)(),(0,i.iD)("button",{key:0,onClick:s[5]||(s[5]=(...e)=>a.toggleProfilePrivacy&&a.toggleProfilePrivacy(...e))},(0,m.zw)("Public"===r.userData.profilePrivacy?"Make Private":"Make Public"),1)):(0,i.kq)("",!0),(0,i._)("div",{onClick:s[6]||(s[6]=e=>r.showFollowing=!r.showFollowing)}," Following "+(0,m.zw)(r.following.length),1),r.showFollowing?((0,i.wg)(),(0,i.iD)("ul",Yr,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.following,(e=>((0,i.wg)(),(0,i.iD)("li",{key:e.userID},(0,m.zw)(e.firstName+" "+e.lastName),1)))),128))])):(0,i.kq)("",!0),(0,i._)("div",{onClick:s[7]||(s[7]=e=>r.showFollowers=!r.showFollowers)}," Followers "+(0,m.zw)(r.followers.length),1),r.showFollowers?((0,i.wg)(),(0,i.iD)("ul",Hr,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.followers,(e=>((0,i.wg)(),(0,i.iD)("li",{key:e.userID},(0,m.zw)(e.firstName+" "+e.lastName),1)))),128))])):(0,i.kq)("",!0)],2),[[t.F8,r.isUserDataVisible]])])])],64)}const Br=e=>((0,i.dD)("data-v-040c21d0"),e=e(),(0,i.Cn)(),e),Zr={class:"content-container"},Qr={class:"posts-display-area"},Xr={key:0,class:"post-container"},ea={class:"post-header"},sa=["src"],oa={class:"user-info"},ta={class:"user-name"},ia={class:"post-date"},na={class:"post-body"},ra={key:0,class:"post-content"},aa=["src"],la={key:1},ca=Br((()=>(0,i._)("p",null,"No posts available.",-1))),ua=[ca];function da(e,s,o,t,n,r){return(0,i.wg)(),(0,i.iD)("div",Zr,[(0,i._)("div",Qr,[n.posts.length>0?((0,i.wg)(),(0,i.iD)("div",Xr,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.posts,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.postID,class:"post-card"},[(0,i._)("div",ea,[(0,i._)("img",{src:e.profilePicture||n.defaultProfilePic,alt:"Profile Image",class:"profile-image"},null,8,sa),(0,i._)("div",oa,[(0,i._)("span",ta,(0,m.zw)(e.firstName)+" "+(0,m.zw)(e.lastName),1),(0,i._)("span",ia,(0,m.zw)(r.formatTimestamp(e.timestamp)),1)])]),(0,i._)("div",na,[e.content?((0,i.wg)(),(0,i.iD)("p",ra,(0,m.zw)(e.content),1)):(0,i.kq)("",!0),e.imageURL?((0,i.wg)(),(0,i.iD)("img",{key:1,src:e.imageURL,alt:"Post image",class:"post-image"},null,8,aa)):(0,i.kq)("",!0)])])))),128))])):((0,i.wg)(),(0,i.iD)("div",la,ua))])])}var pa={data(){return{defaultProfilePic:xs,userProfile:JSON.parse(localStorage.getItem("user"))||{},followRelations:JSON.parse(localStorage.getItem("followRelations"))||[],posts:[]}},mounted(){this.fetchPosts(),this.userProfile=JSON.parse(localStorage.getItem("user"))||{}},computed:{userImage(){return this.userProfile.profilePicture||xs}},props:{currentUserId:Number,groupID:{type:[Number,String,null],default:null}},methods:{formatTimestamp(e){const s=new Date(e);return s.toLocaleDateString("en-US")},fetchPosts(){const e=this.$route.params.userId;this.$axios.get(`api/profilePosts?userId=${e}`).then((e=>{console.log("These are the fetched posts:",e.data),this.posts=Array.isArray(e.data)?e.data:[]})).catch((e=>{console.error("Error fetching posts:",e.response?e.response.data:e.message)}))}}};const ga=(0,l.Z)(pa,[["render",da],["__scopeId","data-v-040c21d0"]]);var ha=ga,ma={name:"ProfilePage",components:{ChatWindow:He,ContentContainer:ha},data(){return{defaultProfilePic:xs,ws:null,serverUrl:"ws://localhost:8091/ws",followRelations:[],isNotificationCenterVisible:!1,messages:[],unreadMessagesCount:{},newMessage:"",currentRoomId:null,openChats:{},groupName:"",groupDescription:"",notifications:[],notificationMessage:"",isUserDataVisible:!1,userData:{},followers:[],following:[],showFollowers:!1,showFollowing:!1,profilePrivacy:"public"}},mounted(){this.connectToWebsocket(),this.loadUserRelations(),this.fetchFollowing(),this.fetchUserDetails();const e=JSON.parse(localStorage.getItem("currentUser"));e&&e.userID&&(this.currentUserId=e.userID)},computed:{...(0,p.rn)(["isLoggedIn"]),currentUserId(){const e=JSON.parse(localStorage.getItem("user"));return e?e.userID:null},filteredOpenChats(){return Array.isArray(this.followRelations)?this.followRelations.filter((e=>this.openChats[e.RoomID])):[]},isAllowedToSeeDetails(){const e=this.currentUserId===this.userData.userID,s=this.followers.some((e=>e.userID===this.currentUserId)),o="public"===this.userData.profilePrivacy;return o||e||s}},methods:{...(0,p.nv)(["logOut"]),handleLogout(){this.$axios.post("/api/logout").then((()=>{this.logOut(),this.$cookies.remove("session_id"),localStorage.clear(),this.$router.push("/welcome")})).catch((e=>{console.error("Logout failed:",e)}))},handleUserClick(e){console.log("Opening chat for room:",e.RoomID),this.currentRoomId=e.RoomID,this.currentRelationUserId=e.UserID,this.unreadMessagesCount[e.RoomID]=0,this.followRelations=this.followRelations.map((s=>s.RoomID===e.RoomID?{...s,UnreadCount:0}:s)),this.fetchMessages(e.RoomID),void 0===this.openChats[e.RoomID]?this.openChats[e.RoomID]=!0:this.openChats[e.RoomID]=!this.openChats[e.RoomID]},handleCloseChat(e){void 0!==this.openChats[e]&&(this.openChats[e]=!1)},fetchMessages(e){let s={type:"fetchMessages",payload:{roomId:e}};console.log("Fetching messages for room:",e),this.ws.send(JSON.stringify(s))},connectToWebsocket(){console.log("Attempting to connect to WebSocket"),this.ws=new WebSocket(this.serverUrl),this.ws.addEventListener("open",(()=>{console.log("Connected to WS!")})),this.ws.addEventListener("message",this.handleNewMessage),this.ws.addEventListener("error",(e=>{console.error("WebSocket Error: ",e)})),this.ws.addEventListener("close",(()=>{console.log("WebSocket connection closed")}))},sendChatMessage(e,s){const o={type:"chatMessage",payload:{senderUserId:this.currentUserId,content:e,roomId:s,timestamp:(new Date).toISOString()}};console.log("Sending chat message:",o),this.ws.send(JSON.stringify(o))},loadUserRelations(){const e=localStorage.getItem("userRelations");e?this.followRelations=JSON.parse(e):console.log("No user relations found")},updateUnreadCount(e){this.unreadMessagesCount[e]=(this.unreadMessagesCount[e]||0)+1,this.followRelations=this.followRelations.map((s=>s.RoomID===e?{...s,UnreadCount:this.unreadMessagesCount[e]}:s))},toggleNotificationCenter(){if(this.isNotificationCenterVisible=!this.isNotificationCenterVisible,this.isNotificationCenterVisible){const e=["eventInvite","groupInvite","followRequestCheck","groupJoinRequestCheck"];e.forEach((e=>{const s={type:e,payload:{userId:this.currentUserId}};console.log("Notifications payload for "+e+":",s),this.ws.send(JSON.stringify(s))}))}},handleResponse(e,s,o){let t;"event"===o?t={type:"eInviteResponse",payload:{responseId:e.responseId,userId:this.currentUserId,response:s}}:"group"===o?t={type:"gInviteResponse",payload:{groupId:e.groupId,userId:this.currentUserId,accept:s}}:"follow"===o?(t={type:s?"acceptFollowRequest":"declineFollowRequest",payload:{userId:this.currentUserId,followerUserId:e.followerUserId}},this.ws.send(JSON.stringify(t)),this.notifications=this.notifications.filter((s=>"followRequest"!==s.type||s.followerUserId!==e.followerUserId))):"groupJoinRequest"===o&&(t={type:s?"acceptGroupJoinRequest":"declineGroupJoinRequest",payload:{userId:this.currentUserId,requestId:e.requestId}}),console.log(`${o} response payload going to backend`,t),this.ws.send(JSON.stringify(t)),"groupJoinRequest"===o?this.notifications=this.notifications.filter((s=>s.requestId!==e.requestId)):"event"!==o&&"group"!==o||(this.notifications=this.notifications.filter((s=>"event"===o?s.responseId!==e.responseId:s.groupId!==e.groupId)))},handleNewMessage(e){console.log("Received WebSocket message:",e.data);const s=e.data.split("\n").filter((e=>e.trim()));let o;if(s.forEach((e=>{try{switch(o=JSON.parse(e),o.type){case"chatMessage":o.payload.roomId===this.currentRoomId?this.messages.push(o.payload):this.openChats[o.payload.roomId]||this.updateUnreadCount(o.payload.roomId);break;case"fetchMessagesResponse":if(console.log("Fetched messages:",o.payload),o.payload.roomId===this.currentRoomId&&o.payload.messages&&o.payload.messages.length>0){const e=o.payload.messages.reverse();this.messages=[...e,...this.messages]}break;case"eventInviteResponse":console.log("Event invite response payload:",o.payload),Array.isArray(o.payload)?o.payload.forEach((e=>{const s=this.notifications.findIndex((s=>"eventInvite"===s.type&&s.responseId===e.responseId));-1===s?this.notifications.push({type:"eventInvite",...e}):this.notifications[s]={...this.notifications[s],...e}})):o.payload.message&&(this.notificationMessage=o.payload.message);break;case"groupInviteResponse":console.log("Group invite response payload:",o.payload),Array.isArray(o.payload)?o.payload.forEach((e=>{const s={type:"groupInvite",groupId:e.GroupID,groupName:e.Name,groupDescription:e.Description,creatorUserId:e.CreatorUserID,creatorName:e.CreatorName},o=this.notifications.findIndex((s=>"groupInvite"===s.type&&s.groupId===e.GroupID));-1===o?this.notifications.push(s):this.notifications[o]={...this.notifications[o],...s}})):o.payload.message&&(this.notificationMessage=o.payload.message);break;case"followRequestResponse":console.log("Follow request payload:",o.payload),Array.isArray(o.payload)&&o.payload.forEach((e=>{const s={type:"followRequest",followerUserId:e.followerUserId,firstName:e.firstName,lastName:e.lastName},o=this.notifications.findIndex((s=>"followRequest"===s.type&&s.followerUserId===e.followerUserId));-1===o?this.notifications.push(s):this.notifications[o]={...this.notifications[o],...s}}));break;case"groupJoinRequestResponse":console.log("Group join request payload:",o.payload),Array.isArray(o.payload)&&o.payload.forEach((e=>{const s={type:"groupJoinRequest",requestId:e.requestId,groupId:e.groupId,groupName:e.groupName,requesterUserId:e.userId,LastName:e.lastName,FirstName:e.firstName};this.notifications.push(s)}));break}}catch(s){console.error("Error parsing individual message:",s)}})),o.userRelations){console.log("User relations received:",o.userRelations);const e=Object.values(o.userRelations);localStorage.setItem("userRelations",JSON.stringify(e))}o.followingMap&&(console.log("Following map received:",o.followingMap),localStorage.setItem("followingMap",JSON.stringify(o.followingMap))),o.followersMap&&(console.log("Followers map received:",o.followersMap),localStorage.setItem("followersMap",JSON.stringify(o.followersMap))),o.pendingRequests&&(console.log("Requests map received:",o.pendingRequests),localStorage.setItem("pendingRequests",JSON.stringify(o.pendingRequests))),o.userGroups&&(console.log("User groups received:",o.userGroups),localStorage.setItem("userGroups",JSON.stringify(o.userGroups))),o.groupJoinRequests&&(console.log("Group join requests received:",o.groupJoinRequests),localStorage.setItem("groupJoinRequests",JSON.stringify(o.groupJoinRequests)))},formatDOB(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})},formatTimestamp(e){const s=new Date(e);return s.toLocaleDateString("en-US")},fetchFollowing(){const e=this.$route.params.userId;this.$axios.get(`api/userFollowing?userId=${e}`).then((s=>{console.log("These are the fetched followings:",s.data),this.following=[],this.followers=[],s.data&&Array.isArray(s.data)?s.data.forEach((e=>{"following"===e.relationType?this.following.push(e):"follower"===e.relationType&&this.followers.push(e)})):console.log("No followings/followers data found for userId:",e)})).catch((e=>{console.error("Error fetching followings:",e.response?e.response.data:e.message)}))},fetchUserDetails(){const e=this.$route.params.userId;this.$axios.get(`api/userDetails?userId=${e}`).then((e=>{console.log(e.data),this.userData=e.data})).catch((e=>{console.error("Error fetching user details:",e)}))},toggleProfilePrivacy(){const e="Public"===this.userData.profilePrivacy?"Private":"Public";this.$axios.post("/api/toggleProfilePrivacy",{userId:this.userData.userID,profilePrivacy:e}).then((s=>{console.log("Profile privacy updated:",s.data),this.userData.profilePrivacy=e})).catch((e=>{console.error("Error toggling profile privacy:",e)}))}}};const fa=(0,l.Z)(ma,[["render",Kr],["__scopeId","data-v-171fc8f8"]]);var wa=fa;const Ia=[{path:"/welcome",name:"Welcome",component:j,meta:{requiresAuth:!1}},{path:"/",name:"Home",component:Hs,meta:{requiresAuth:!0}},{path:"/groups",name:"Groups",component:pt,meta:{requiresAuth:!0}},{path:"/users",name:"Users",component:mi,meta:{requiresAuth:!0}},{path:"/group/:groupId",name:"GroupDetail",component:Xn,meta:{requiresAuth:!0}},{path:"/profile/:userId?",name:"ProfilePage",component:wa,meta:{requiresAuth:!0}}],va=(0,d.p7)({history:(0,d.PO)(),routes:Ia});va.beforeEach(((e,s,o)=>{const t=e.matched.some((e=>e.meta.requiresAuth)),i=h.state.isLoggedIn;t&&!i?o("/welcome"):!t&&i?o("/"):o()}));var ya=va,Ua=o(5269),ka=o.n(Ua);Ws.Z.defaults.baseURL="http://localhost:8091",Ws.Z.defaults.withCredentials=!0;const Ca=(0,t.ri)(u);Ca.use(ka()),Ca.use(ya),Ca.use(h),Ca.config.globalProperties.$axios=Ws.Z,Ca.mount("#app"),Ca.config.globalProperties.$cookies.isKey("session_id")||(localStorage.clear(),h.dispatch("logOut"),ya.push("/welcome"))}},s={};function o(t){var i=s[t];if(void 0!==i)return i.exports;var n=s[t]={exports:{}};return e[t].call(n.exports,n,n.exports,o),n.exports}o.m=e,function(){var e=[];o.O=function(s,t,i,n){if(!t){var r=1/0;for(u=0;u<e.length;u++){t=e[u][0],i=e[u][1],n=e[u][2];for(var a=!0,l=0;l<t.length;l++)(!1&n||r>=n)&&Object.keys(o.O).every((function(e){return o.O[e](t[l])}))?t.splice(l--,1):(a=!1,n<r&&(r=n));if(a){e.splice(u--,1);var c=i();void 0!==c&&(s=c)}}return s}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[t,i,n]}}(),function(){o.n=function(e){var s=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(s,{a:s}),s}}(),function(){o.d=function(e,s){for(var t in s)o.o(s,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:s[t]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};o.O.j=function(s){return 0===e[s]};var s=function(s,t){var i,n,r=t[0],a=t[1],l=t[2],c=0;if(r.some((function(s){return 0!==e[s]}))){for(i in a)o.o(a,i)&&(o.m[i]=a[i]);if(l)var u=l(o)}for(s&&s(t);c<r.length;c++)n=r[c],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return o.O(u)},t=self["webpackChunksocial_network"]=self["webpackChunksocial_network"]||[];t.forEach(s.bind(null,0)),t.push=s.bind(null,t.push.bind(t))}();var t=o.O(void 0,[998],(function(){return o(7571)}));t=o.O(t)})();
//# sourceMappingURL=app.1a9ef442.js.map